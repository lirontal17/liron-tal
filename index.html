import React, { useState, useEffect, useMemo, useCallback } from 'react';

// --- CONFIGURATION ---
const CLASSES_PER_GRADE = { 'ז': 8, 'ח': 8, 'ט': 8, 'י': 8, 'יא': 8, 'יב': 8 };

// --- GRADING DATA (Updated based on provided documents) ---
const GRADING_DATA = {
    "בנות": {
        "ז": {
            "ריצת 1500": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "07:29"}, {score: 95, threshold: "08:06"}, {score: 90, threshold: "08:44"}, {score: 85, threshold: "09:24"}, {score: 80, threshold: "10:05"}, {score: 75, threshold: "10:57"}, {score: 70, threshold: "12:04"}, {score: 65, threshold: "13:18"}, {score: 60, threshold: "14:33"}, {score: 55, threshold: "15:48"}, {score: 50, threshold: "16:45"}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 40}, {score: 90, threshold: 37}, {score: 80, threshold: 34}, {score: 70, threshold: 32}, {score: 60, threshold: 29}, {score: 50, threshold: 27}, {score: 45, threshold: 24}, {score: 40, threshold: 22}, {score: 35, threshold: 19}, {score: 25, threshold: 15}, {score: 20, threshold: 10}]},
            "דלגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 100}, {score: 90, threshold: 90}, {score: 80, threshold: 80}, {score: 70, threshold: 70}, {score: 60, threshold: 60}, {score: 50, threshold: 50}, {score: 45, threshold: 45}, {score: 40, threshold: 40}, {score: 35, threshold: 35}, {score: 25, threshold: 25}, {score: 20, threshold: 20}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 13.00}, {score: 95, threshold: 13.20}, {score: 90, threshold: 13.40}, {score: 85, threshold: 13.70}, {score: 80, threshold: 14.00}, {score: 75, threshold: 14.30}, {score: 70, threshold: 14.60}, {score: 65, threshold: 14.90}, {score: 60, threshold: 15.20}, {score: 55, threshold: 15.50}, {score: 50, threshold: 15.80}]},
            "קפיצה למרחק מהמקום": { unit: "מטר", lowerIsBetter: false, grades: [{score: 100, threshold: 1.78}, {score: 95, threshold: 1.72}, {score: 90, threshold: 1.68}, {score: 85, threshold: 1.64}, {score: 80, threshold: 1.60}, {score: 75, threshold: 1.56}, {score: 70, threshold: 1.52}, {score: 65, threshold: 1.48}, {score: 60, threshold: 1.44}, {score: 55, threshold: 1.40}, {score: 50, threshold: 1.36}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 10.9}, {score: 95, threshold: 11.4}, {score: 90, threshold: 11.9}, {score: 85, threshold: 12.4}, {score: 80, threshold: 12.9}, {score: 75, threshold: 13.4}, {score: 70, threshold: 13.9}, {score: 65, threshold: 14.4}, {score: 60, threshold: 14.9}, {score: 55, threshold: 15.4}, {score: 50, threshold: 15.6}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 30}, {score: 90, threshold: 27}, {score: 80, threshold: 25}, {score: 70, threshold: 22}, {score: 60, threshold: 20}, {score: 50, threshold: 17}, {score: 45, threshold: 15}, {score: 40, threshold: 13}, {score: 35, threshold: 11}, {score: 25, threshold: 10}, {score: 20, threshold: 5}]}
        },
        "ח": {
            "ריצת 1500": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "07:17"}, {score: 95, threshold: "07:52"}, {score: 90, threshold: "08:28"}, {score: 85, threshold: "09:09"}, {score: 80, threshold: "09:50"}, {score: 75, threshold: "10:35"}, {score: 70, threshold: "11:36"}, {score: 65, threshold: "12:48"}, {score: 60, threshold: "14:03"}, {score: 55, threshold: "15:18"}, {score: 50, threshold: "16:33"}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 50}, {score: 90, threshold: 45}, {score: 80, threshold: 40}, {score: 70, threshold: 38}, {score: 60, threshold: 35}, {score: 50, threshold: 33}, {score: 45, threshold: 30}, {score: 40, threshold: 28}, {score: 35, threshold: 25}, {score: 30, threshold: 20}, {score: 25, threshold: 15}]},
            "דלגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 110}, {score: 90, threshold: 100}, {score: 80, threshold: 90}, {score: 70, threshold: 80}, {score: 60, threshold: 70}, {score: 50, threshold: 60}, {score: 45, threshold: 50}, {score: 40, threshold: 40}, {score: 35, threshold: 35}, {score: 30, threshold: 30}, {score: 25, threshold: 25}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 12.2}, {score: 95, threshold: 12.5}, {score: 90, threshold: 12.8}, {score: 85, threshold: 13.1}, {score: 80, threshold: 13.4}, {score: 75, threshold: 13.7}, {score: 70, threshold: 14.0}, {score: 65, threshold: 14.3}, {score: 60, threshold: 14.6}, {score: 55, threshold: 14.9}, {score: 50, threshold: 15.2}]},
            "קפיצה למרחק מהמקום": { unit: "מטר", lowerIsBetter: false, grades: [{score: 100, threshold: 1.85}, {score: 95, threshold: 1.82}, {score: 90, threshold: 1.79}, {score: 85, threshold: 1.75}, {score: 80, threshold: 1.71}, {score: 75, threshold: 1.67}, {score: 70, threshold: 1.62}, {score: 65, threshold: 1.58}, {score: 60, threshold: 1.54}, {score: 55, threshold: 1.50}, {score: 50, threshold: 1.46}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 10.7}, {score: 95, threshold: 11.2}, {score: 90, threshold: 11.7}, {score: 85, threshold: 12.2}, {score: 80, threshold: 12.7}, {score: 75, threshold: 13.2}, {score: 70, threshold: 13.7}, {score: 65, threshold: 14.2}, {score: 60, threshold: 14.7}, {score: 55, threshold: 15.2}, {score: 50, threshold: 15.5}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 35}, {score: 90, threshold: 32}, {score: 80, threshold: 30}, {score: 70, threshold: 28}, {score: 60, threshold: 26}, {score: 50, threshold: 23}, {score: 45, threshold: 21}, {score: 40, threshold: 20}, {score: 35, threshold: 17}, {score: 30, threshold: 15}, {score: 25, threshold: 10}]}
        },
        "ט": {
            "ריצת 1500": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "07:07"}, {score: 95, threshold: "07:36"}, {score: 90, threshold: "08:13"}, {score: 85, threshold: "08:52"}, {score: 80, threshold: "09:36"}, {score: 75, threshold: "10:15"}, {score: 70, threshold: "11:10"}, {score: 65, threshold: "12:18"}, {score: 60, threshold: "13:33"}, {score: 55, threshold: "14:48"}, {score: 50, threshold: "16:00"}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 60}, {score: 90, threshold: 55}, {score: 80, threshold: 50}, {score: 70, threshold: 48}, {score: 60, threshold: 45}, {score: 50, threshold: 43}, {score: 45, threshold: 40}, {score: 40, threshold: 38}, {score: 35, threshold: 35}, {score: 30, threshold: 30}, {score: 25, threshold: 25}]},
            "דלגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 120}, {score: 90, threshold: 110}, {score: 80, threshold: 100}, {score: 70, threshold: 90}, {score: 60, threshold: 80}, {score: 50, threshold: 70}, {score: 45, threshold: 60}, {score: 40, threshold: 50}, {score: 35, threshold: 40}, {score: 30, threshold: 35}, {score: 25, threshold: 30}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 11.7}, {score: 95, threshold: 12.2}, {score: 90, threshold: 12.7}, {score: 85, threshold: 13.2}, {score: 80, threshold: 13.7}, {score: 75, threshold: 14.2}, {score: 70, threshold: 14.7}, {score: 65, threshold: 15.2}, {score: 60, threshold: 16.00}, {score: 55, threshold: 17.00}, {score: 50, threshold: 17.06}]},
            "קפיצה למרחק מהמקום": { unit: "מטר", lowerIsBetter: false, grades: [{score: 100, threshold: 1.90}, {score: 95, threshold: 1.86}, {score: 90, threshold: 1.82}, {score: 85, threshold: 1.78}, {score: 80, threshold: 1.72}, {score: 75, threshold: 1.68}, {score: 70, threshold: 1.64}, {score: 65, threshold: 1.60}, {score: 60, threshold: 1.56}, {score: 55, threshold: 1.52}, {score: 50, threshold: 1.48}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 10.5}, {score: 95, threshold: 11.0}, {score: 90, threshold: 11.5}, {score: 85, threshold: 12.0}, {score: 80, threshold: 12.5}, {score: 75, threshold: 13.0}, {score: 70, threshold: 13.5}, {score: 65, threshold: 14.0}, {score: 60, threshold: 14.5}, {score: 55, threshold: 15.0}, {score: 50, threshold: 15.5}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 45}, {score: 90, threshold: 43}, {score: 80, threshold: 41}, {score: 70, threshold: 40}, {score: 60, threshold: 36}, {score: 50, threshold: 34}, {score: 45, threshold: 30}, {score: 40, threshold: 28}, {score: 35, threshold: 26}, {score: 30, threshold: 25}, {score: 25, threshold: 20}]}
        },
        "י": {
            "דילגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 130}, {score: 95, threshold: 120}, {score: 90, threshold: 115}, {score: 85, threshold: 110}, {score: 80, threshold: 105}, {score: 75, threshold: 100}, {score: 70, threshold: 95}, {score: 65, threshold: 90}, {score: 60, threshold: 85}, {score: 55, threshold: 80}, {score: 50, threshold: 75}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 70}, {score: 95, threshold: 68}, {score: 90, threshold: 65}, {score: 85, threshold: 63}, {score: 80, threshold: 60}, {score: 75, threshold: 56}, {score: 70, threshold: 50}, {score: 65, threshold: 46}, {score: 60, threshold: 40}, {score: 55, threshold: 35}, {score: 50, threshold: 26}]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "08:30"}, {score: 95, threshold: "09:14"}, {score: 90, threshold: "09:58"}, {score: 85, threshold: "10:48"}, {score: 80, threshold: "11:38"}, {score: 75, threshold: "12:28"}, {score: 70, threshold: "13:20"}, {score: 65, threshold: "14:15"}, {score: 60, threshold: "15:25"}, {score: 55, threshold: "16:10"}, {score: 50, threshold: "17:00"}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 10.3}, {score: 95, threshold: 11}, {score: 90, threshold: 11.5}, {score: 85, threshold: 12}, {score: 80, threshold: 12.5}, {score: 75, threshold: 13}, {score: 70, threshold: 13.5}, {score: 65, threshold: 14}, {score: 60, threshold: 14.5}, {score: 55, threshold: 15.5}, {score: 50, threshold: 16}]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [{score: 100, threshold: 208}, {score: 95, threshold: 202}, {score: 90, threshold: 196}, {score: 85, threshold: 185}, {score: 80, threshold: 170}, {score: 75, threshold: 154}, {score: 70, threshold: 141}, {score: 65, threshold: 126}, {score: 60, threshold: 111}, {score: 55, threshold: 96}, {score: 50, threshold: 87}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 11.8}, {score: 95, threshold: 12.01}, {score: 90, threshold: 12.4}, {score: 85, threshold: 12.7}, {score: 80, threshold: 13.0}, {score: 75, threshold: 13.3}, {score: 70, threshold: 13.6}, {score: 65, threshold: 13.9}, {score: 60, threshold: 14.2}, {score: 55, threshold: 14.6}, {score: 50, threshold: 14.9}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 55}, {score: 95, threshold: 52}, {score: 90, threshold: 50}, {score: 85, threshold: 49}, {score: 80, threshold: 47}, {score: 75, threshold: 45}, {score: 70, threshold: 42}, {score: 65, threshold: 40}, {score: 60, threshold: 37}, {score: 55, threshold: 35}, {score: 50, threshold: 30}]}
        },
        "יא": {
            "דילגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 135}, {score: 95, threshold: 130}, {score: 90, threshold: 125}, {score: 85, threshold: 120}, {score: 80, threshold: 115}, {score: 75, threshold: 110}, {score: 70, threshold: 105}, {score: 65, threshold: 100}, {score: 60, threshold: 85}, {score: 55, threshold: 75}, {score: 50, threshold: 65}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 80}, {score: 95, threshold: 73}, {score: 90, threshold: 75}, {score: 85, threshold: 72}, {score: 80, threshold: 66}, {score: 75, threshold: 62}, {score: 70, threshold: 56}, {score: 65, threshold: 52}, {score: 60, threshold: 46}, {score: 55, threshold: 40}, {score: 50, threshold: 30}]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "08:10"}, {score: 95, threshold: "08:52"}, {score: 90, threshold: "09:32"}, {score: 85, threshold: "10:14"}, {score: 80, threshold: "11:05"}, {score: 75, threshold: "11:55"}, {score: 70, threshold: "12:45"}, {score: 65, threshold: "13:50"}, {score: 60, threshold: "15:05"}, {score: 55, threshold: "16:00"}, {score: 50, threshold: "16:50"}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 10}, {score: 95, threshold: 10.6}, {score: 90, threshold: 11.2}, {score: 85, threshold: 11.6}, {score: 80, threshold: 12.3}, {score: 75, threshold: 12.8}, {score: 70, threshold: 13.4}, {score: 65, threshold: 13.9}, {score: 60, threshold: 14.4}, {score: 55, threshold: 15}, {score: 50, threshold: 15.5}]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [{score: 100, threshold: 211}, {score: 95, threshold: 203}, {score: 90, threshold: 197}, {score: 85, threshold: 191}, {score: 80, threshold: 176}, {score: 75, threshold: 158}, {score: 70, threshold: 141}, {score: 65, threshold: 126}, {score: 60, threshold: 111}, {score: 55, threshold: 96}, {score: 50, threshold: 87}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 11.4}, {score: 95, threshold: 11.7}, {score: 90, threshold: 12.0}, {score: 85, threshold: 12.3}, {score: 80, threshold: 12.6}, {score: 75, threshold: 12.9}, {score: 70, threshold: 13.2}, {score: 65, threshold: 13.5}, {score: 60, threshold: 13.9}, {score: 55, threshold: 14.3}, {score: 50, threshold: 14.6}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 65}, {score: 95, threshold: 63}, {score: 90, threshold: 61}, {score: 85, threshold: 60}, {score: 80, threshold: 58}, {score: 75, threshold: 56}, {score: 70, threshold: 55}, {score: 65, threshold: 51}, {score: 60, threshold: 45}, {score: 55, threshold: 40}, {score: 50, threshold: 35}]}
        },
        "יב": {
            "דילגית 60 שנ'": { unit: "קפיצות", lowerIsBetter: false, grades: [{score: 100, threshold: 140}, {score: 95, threshold: 130}, {score: 90, threshold: 120}, {score: 85, threshold: 115}, {score: 80, threshold: 110}, {score: 75, threshold: 105}, {score: 70, threshold: 100}, {score: 65, threshold: 95}, {score: 60, threshold: 90}, {score: 55, threshold: 85}, {score: 50, threshold: 80}]},
            "פלאנק בשניות": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 90}, {score: 95, threshold: 85}, {score: 90, threshold: 80}, {score: 85, threshold: 75}, {score: 80, threshold: 70}, {score: 75, threshold: 65}, {score: 70, threshold: 60}, {score: 65, threshold: 55}, {score: 60, threshold: 50}, {score: 55, threshold: 45}, {score: 50, threshold: 40}]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [{score: 100, threshold: "08:00"}, {score: 95, threshold: "08:44"}, {score: 90, threshold: "09:34"}, {score: 85, threshold: "10:25"}, {score: 80, threshold: "11:15"}, {score: 75, threshold: "12:05"}, {score: 70, threshold: "12:55"}, {score: 65, threshold: "13:45"}, {score: 60, threshold: "14:35"}, {score: 55, threshold: "15:50"}, {score: 50, threshold: "17:00"}]},
            "4x10": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 9.5}, {score: 95, threshold: 10}, {score: 90, threshold: 10.6}, {score: 85, threshold: 11.4}, {score: 80, threshold: 12.1}, {score: 75, threshold: 12.6}, {score: 70, threshold: 13.2}, {score: 65, threshold: 13.7}, {score: 60, threshold: 14.2}, {score: 55, threshold: 14.7}, {score: 50, threshold: 15.5}]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [{score: 100, threshold: 215}, {score: 95, threshold: 206}, {score: 90, threshold: 200}, {score: 85, threshold: 194}, {score: 80, threshold: 184}, {score: 75, threshold: 173}, {score: 70, threshold: 157}, {score: 65, threshold: 140}, {score: 60, threshold: 115}, {score: 55, threshold: 96}, {score: 50, threshold: 87}]},
            "ריצת 80 מ'": { unit: "שניות", lowerIsBetter: true, grades: [{score: 100, threshold: 11.0}, {score: 95, threshold: 11.3}, {score: 90, threshold: 11.6}, {score: 85, threshold: 11.9}, {score: 80, threshold: 12.2}, {score: 75, threshold: 12.5}, {score: 70, threshold: 12.9}, {score: 65, threshold: 13.3}, {score: 60, threshold: 13.7}, {score: 55, threshold: 14.1}, {score: 50, threshold: 14.4}]},
            "תליית און": { unit: "שניות", lowerIsBetter: false, grades: [{score: 100, threshold: 75}, {score: 95, threshold: 72}, {score: 90, threshold: 70}, {score: 85, threshold: 67}, {score: 80, threshold: 64}, {score: 75, threshold: 61}, {score: 70, threshold: 58}, {score: 65, threshold: 52}, {score: 60, threshold: 49}, {score: 55, threshold: 45}, {score: 50, threshold: 40}]}
        }
    },
    "בנים": {
        "ז": {
            "ריצת 60 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 9.00}, {score: 99, threshold: 9.04}, {score: 98, threshold: 9.08}, {score: 97, threshold: 9.12}, {score: 96, threshold: 9.16}, {score: 95, threshold: 9.20}, {score: 94, threshold: 9.24}, {score: 93, threshold: 9.28}, {score: 92, threshold: 9.32}, {score: 91, threshold: 9.36}, {score: 90, threshold: 9.40}, {score: 89, threshold: 9.46}, {score: 88, threshold: 9.50}, {score: 87, threshold: 9.54}, {score: 86, threshold: 9.56}, {score: 85, threshold: 9.60}, {score: 84, threshold: 9.64}, {score: 83, threshold: 9.68}, {score: 82, threshold: 9.72}, {score: 81, threshold: 9.76}, {score: 80, threshold: 9.80}, {score: 79, threshold: 9.86}, {score: 78, threshold: 9.90}, {score: 77, threshold: 9.94}, {score: 76, threshold: 10.00}, {score: 75, threshold: 10.06}, {score: 74, threshold: 10.10}, {score: 73, threshold: 10.20}, {score: 72, threshold: 10.30}, {score: 71, threshold: 10.40}, {score: 70, threshold: 10.50}, {score: 69, threshold: 10.60}, {score: 68, threshold: 10.70}, {score: 67, threshold: 10.80}, {score: 66, threshold: 10.90}, {score: 65, threshold: 11.00}, {score: 60, threshold: 11.20}, {score: 55, threshold: 11.70}, {score: 50, threshold: 12.10} ]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 200}, {score: 99, threshold: 197}, {score: 98, threshold: 194}, {score: 97, threshold: 192}, {score: 96, threshold: 190}, {score: 95, threshold: 188}, {score: 94, threshold: 186}, {score: 93, threshold: 184}, {score: 92, threshold: 182}, {score: 91, threshold: 180}, {score: 90, threshold: 178}, {score: 89, threshold: 176}, {score: 88, threshold: 174}, {score: 87, threshold: 172}, {score: 86, threshold: 170}, {score: 85, threshold: 168}, {score: 84, threshold: 166}, {score: 83, threshold: 164}, {score: 82, threshold: 162}, {score: 81, threshold: 160}, {score: 80, threshold: 158}, {score: 79, threshold: 156}, {score: 78, threshold: 154}, {score: 77, threshold: 152}, {score: 76, threshold: 150}, {score: 75, threshold: 147}, {score: 74, threshold: 144}, {score: 73, threshold: 141}, {score: 72, threshold: 138}, {score: 71, threshold: 135}, {score: 70, threshold: 132}, {score: 69, threshold: 129}, {score: 68, threshold: 126}, {score: 67, threshold: 123}, {score: 66, threshold: 120}, {score: 65, threshold: 117}, {score: 60, threshold: 102}, {score: 55, threshold: 89}, {score: 50, threshold: 80} ]},
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 10.00}, {score: 99, threshold: 10.1}, {score: 98, threshold: 10.2}, {score: 97, threshold: 10.3}, {score: 96, threshold: 10.4}, {score: 95, threshold: 10.5}, {score: 94, threshold: 10.6}, {score: 93, threshold: 10.7}, {score: 92, threshold: 10.8}, {score: 91, threshold: 10.9}, {score: 90, threshold: 11.0}, {score: 89, threshold: 11.1}, {score: 88, threshold: 11.2}, {score: 87, threshold: 11.3}, {score: 86, threshold: 11.4}, {score: 85, threshold: 11.5}, {score: 84, threshold: 11.6}, {score: 83, threshold: 11.7}, {score: 82, threshold: 11.8}, {score: 81, threshold: 11.9}, {score: 80, threshold: 12.0}, {score: 75, threshold: 12.5}, {score: 70, threshold: 13.0}, {score: 65, threshold: 13.5}, {score: 60, threshold: 14.0}, {score: 55, threshold: 15.0}, {score: 50, threshold: 15.5} ]},
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 9}, {score: 97, threshold: 8}, {score: 94, threshold: 7}, {score: 90, threshold: 6}, {score: 85, threshold: 5}, {score: 80, threshold: 4}, {score: 70, threshold: 3}, {score: 65, threshold: 2}, {score: 60, threshold: 1}, {score: 55, threshold: 0} ]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "8:00"}, {score: 99, threshold: "8:10"}, {score: 98, threshold: "8:20"}, {score: 97, threshold: "8:28"}, {score: 96, threshold: "8:51"}, {score: 95, threshold: "8:59"}, {score: 94, threshold: "9:09"}, {score: 93, threshold: "9:16"}, {score: 92, threshold: "9:25"}, {score: 91, threshold: "9:34"}, {score: 90, threshold: "9:43"}, {score: 85, threshold: "10:32"}, {score: 80, threshold: "11:27"}, {score: 75, threshold: "12:26"}, {score: 70, threshold: "13:38"}, {score: 65, threshold: "14:52"}, {score: 60, threshold: "15:50"}, {score: 55, threshold: "16:46"}, {score: 50, threshold: "17:36"} ]},
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 60}, {score: 95, threshold: 55}, {score: 90, threshold: 50}, {score: 85, threshold: 45}, {score: 80, threshold: 40}, {score: 75, threshold: 35}, {score: 70, threshold: 30}, {score: 65, threshold: 25}, {score: 60, threshold: 20}, {score: 55, threshold: 15}, {score: 50, threshold: 10} ]},
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 120}, {score: 95, threshold: 110}, {score: 90, threshold: 100}, {score: 85, threshold: 90}, {score: 80, threshold: 85}, {score: 75, threshold: 80}, {score: 70, threshold: 75}, {score: 65, threshold: 70}, {score: 60, threshold: 65}, {score: 55, threshold: 60}, {score: 50, threshold: 55} ]},
            "שכיבות סמיכה": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 30}, {score: 98, threshold: 29}, {score: 96, threshold: 28}, {score: 94, threshold: 27}, {score: 92, threshold: 26}, {score: 90, threshold: 25}, {score: 88, threshold: 24}, {score: 86, threshold: 23}, {score: 84, threshold: 22}, {score: 82, threshold: 21}, {score: 80, threshold: 20}, {score: 78, threshold: 19}, {score: 74, threshold: 18}, {score: 71, threshold: 17}, {score: 68, threshold: 16}, {score: 66, threshold: 15}, {score: 64, threshold: 14}, {score: 62, threshold: 13}, {score: 60, threshold: 12}, {score: 58, threshold: 11}, {score: 56, threshold: 10}, {score: 53, threshold: 9}, {score: 51, threshold: 8} ]}
        },
        "ח": {
            "ריצת 60 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 8.80}, {score: 99, threshold: 8.82}, {score: 98, threshold: 8.84}, {score: 97, threshold: 8.86}, {score: 96, threshold: 8.88}, {score: 95, threshold: 8.90}, {score: 94, threshold: 8.92}, {score: 93, threshold: 8.94}, {score: 92, threshold: 8.96}, {score: 91, threshold: 8.98}, {score: 90, threshold: 9.00}, {score: 85, threshold: 9.10}, {score: 80, threshold: 9.30}, {score: 75, threshold: 9.50}, {score: 70, threshold: 9.70}, {score: 65, threshold: 10.20}, {score: 60, threshold: 10.70}, {score: 55, threshold: 11.20}, {score: 50, threshold: 11.70} ]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 210}, {score: 99, threshold: 208}, {score: 98, threshold: 206}, {score: 97, threshold: 204}, {score: 96, threshold: 202}, {score: 95, threshold: 200}, {score: 94, threshold: 198}, {score: 93, threshold: 196}, {score: 92, threshold: 194}, {score: 91, threshold: 192}, {score: 90, threshold: 190}, {score: 85, threshold: 175}, {score: 80, threshold: 161}, {score: 75, threshold: 150}, {score: 70, threshold: 138}, {score: 65, threshold: 126}, {score: 60, threshold: 112}, {score: 55, threshold: 100}, {score: 50, threshold: 87} ]},
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 9.8}, {score: 99, threshold: 9.9}, {score: 98, threshold: 10.0}, {score: 97, threshold: 10.1}, {score: 96, threshold: 10.2}, {score: 95, threshold: 10.3}, {score: 94, threshold: 10.4}, {score: 93, threshold: 10.5}, {score: 92, threshold: 10.6}, {score: 91, threshold: 10.7}, {score: 90, threshold: 10.8}, {score: 85, threshold: 11.3}, {score: 80, threshold: 11.8}, {score: 75, threshold: 12.3}, {score: 70, threshold: 12.8}, {score: 65, threshold: 13.3}, {score: 60, threshold: 13.8}, {score: 55, threshold: 14.6}, {score: 50, threshold: 15.2} ]},
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 10}, {score: 97, threshold: 9}, {score: 94, threshold: 8}, {score: 89, threshold: 7}, {score: 85, threshold: 6}, {score: 80, threshold: 5}, {score: 75, threshold: 4}, {score: 70, threshold: 3}, {score: 65, threshold: 2}, {score: 60, threshold: 1}, {score: 55, threshold: 0} ]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "7:54"}, {score: 99, threshold: "8:00"}, {score: 98, threshold: "8:07"}, {score: 97, threshold: "8:14"}, {score: 96, threshold: "8:21"}, {score: 95, threshold: "8:28"}, {score: 94, threshold: "8:35"}, {score: 93, threshold: "8:43"}, {score: 92, threshold: "8:52"}, {score: 91, threshold: "8:59"}, {score: 90, threshold: "9:09"}, {score: 85, threshold: "9:52"}, {score: 80, threshold: "10:43"}, {score: 75, threshold: "11:38"}, {score: 70, threshold: "12:40"}, {score: 65, threshold: "13:52"}, {score: 60, threshold: "15:08"}, {score: 55, threshold: "16:02"}, {score: 50, threshold: "16:56"} ]},
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 70}, {score: 95, threshold: 65}, {score: 90, threshold: 60}, {score: 85, threshold: 55}, {score: 80, threshold: 48}, {score: 75, threshold: 38}, {score: 70, threshold: 33}, {score: 65, threshold: 27}, {score: 60, threshold: 25}, {score: 55, threshold: 20}, {score: 50, threshold: 18} ]},
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 130}, {score: 95, threshold: 117}, {score: 90, threshold: 106}, {score: 85, threshold: 94}, {score: 80, threshold: 83}, {score: 75, threshold: 77}, {score: 70, threshold: 70}, {score: 65, threshold: 62}, {score: 60, threshold: 56}, {score: 55, threshold: 49}, {score: 50, threshold: 44} ]},
            "שכיבות סמיכה": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 35}, {score: 98, threshold: 34}, {score: 96, threshold: 33}, {score: 94, threshold: 32}, {score: 92, threshold: 31}, {score: 90, threshold: 30}, {score: 88, threshold: 29}, {score: 86, threshold: 28}, {score: 84, threshold: 27}, {score: 82, threshold: 26}, {score: 80, threshold: 25}, {score: 78, threshold: 24}, {score: 76, threshold: 23}, {score: 74, threshold: 22}, {score: 72, threshold: 21}, {score: 70, threshold: 20}, {score: 68, threshold: 19}, {score: 65, threshold: 18}, {score: 62, threshold: 17}, {score: 60, threshold: 16}, {score: 56, threshold: 15}, {score: 54, threshold: 14}, {score: 52, threshold: 13}, {score: 50, threshold: 12} ]}
        },
        "ט": {
            "ריצת 60 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 8.50}, {score: 99, threshold: 8.55}, {score: 98, threshold: 8.60}, {score: 97, threshold: 8.65}, {score: 96, threshold: 8.70}, {score: 95, threshold: 8.75}, {score: 94, threshold: 8.80}, {score: 93, threshold: 8.85}, {score: 92, threshold: 8.90}, {score: 91, threshold: 8.95}, {score: 90, threshold: 9.00}, {score: 85, threshold: 9.25}, {score: 80, threshold: 9.50}, {score: 75, threshold: 9.75}, {score: 70, threshold: 10.00}, {score: 65, threshold: 10.10}, {score: 60, threshold: 10.20}, {score: 55, threshold: 10.30}, {score: 50, threshold: 10.50} ]},
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 220}, {score: 99, threshold: 218}, {score: 98, threshold: 216}, {score: 97, threshold: 214}, {score: 96, threshold: 212}, {score: 95, threshold: 210}, {score: 94, threshold: 208}, {score: 93, threshold: 206}, {score: 92, threshold: 204}, {score: 91, threshold: 202}, {score: 90, threshold: 200}, {score: 85, threshold: 190}, {score: 80, threshold: 180}, {score: 75, threshold: 170}, {score: 70, threshold: 160}, {score: 65, threshold: 150}, {score: 60, threshold: 133}, {score: 55, threshold: 118}, {score: 50, threshold: 100} ]},
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 9.5}, {score: 99, threshold: 9.6}, {score: 98, threshold: 9.7}, {score: 97, threshold: 9.8}, {score: 96, threshold: 9.9}, {score: 95, threshold: 10.0}, {score: 94, threshold: 10.1}, {score: 93, threshold: 10.2}, {score: 92, threshold: 10.3}, {score: 91, threshold: 10.4}, {score: 90, threshold: 10.5}, {score: 85, threshold: 11.0}, {score: 80, threshold: 11.5}, {score: 75, threshold: 12.0}, {score: 70, threshold: 12.5}, {score: 65, threshold: 13.0}, {score: 60, threshold: 13.6}, {score: 55, threshold: 14.2}, {score: 50, threshold: 15.0} ]},
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 14}, {score: 97, threshold: 13}, {score: 93, threshold: 12}, {score: 90, threshold: 11}, {score: 88, threshold: 10}, {score: 86, threshold: 9}, {score: 83, threshold: 8}, {score: 80, threshold: 7}, {score: 77, threshold: 6}, {score: 73, threshold: 5}, {score: 70, threshold: 4}, {score: 66, threshold: 3}, {score: 60, threshold: 2}, {score: 55, threshold: 1}, {score: 50, threshold: 0} ]},
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "7:40"}, {score: 99, threshold: "7:45"}, {score: 98, threshold: "7:52"}, {score: 97, threshold: "7:59"}, {score: 96, threshold: "8:07"}, {score: 95, threshold: "8:16"}, {score: 94, threshold: "8:21"}, {score: 93, threshold: "8:28"}, {score: 92, threshold: "8:35"}, {score: 91, threshold: "8:43"}, {score: 90, threshold: "8:52"}, {score: 85, threshold: "9:34"}, {score: 80, threshold: "10:20"}, {score: 75, threshold: "11:05"}, {score: 70, threshold: "12:02"}, {score: 65, threshold: "13:10"}, {score: 60, threshold: "14:22"}, {score: 55, threshold: "15:40"}, {score: 50, threshold: "16:50"} ]},
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 80}, {score: 95, threshold: 75}, {score: 90, threshold: 70}, {score: 85, threshold: 65}, {score: 80, threshold: 60}, {score: 75, threshold: 50}, {score: 70, threshold: 40}, {score: 65, threshold: 35}, {score: 60, threshold: 29}, {score: 55, threshold: 24}, {score: 50, threshold: 18} ]},
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 140}, {score: 95, threshold: 130}, {score: 90, threshold: 120}, {score: 85, threshold: 110}, {score: 80, threshold: 105}, {score: 75, threshold: 100}, {score: 70, threshold: 90}, {score: 65, threshold: 80}, {score: 60, threshold: 70}, {score: 55, threshold: 60}, {score: 50, threshold: 50} ]},
            "שכיבות סמיכה": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 38}, {score: 98, threshold: 37}, {score: 96, threshold: 36}, {score: 94, threshold: 35}, {score: 92, threshold: 34}, {score: 90, threshold: 33}, {score: 88, threshold: 32}, {score: 86, threshold: 31}, {score: 84, threshold: 30}, {score: 82, threshold: 29}, {score: 80, threshold: 28}, {score: 78, threshold: 27}, {score: 76, threshold: 26}, {score: 75, threshold: 25}, {score: 73, threshold: 24}, {score: 71, threshold: 23}, {score: 69, threshold: 22}, {score: 67, threshold: 21}, {score: 65, threshold: 20}, {score: 63, threshold: 19}, {score: 61, threshold: 18}, {score: 59, threshold: 17}, {score: 57, threshold: 16}, {score: 55, threshold: 15}, {score: 53, threshold: 14}, {score: 50, threshold: 13} ]}
        },
        "י": {
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "7:30"}, {score: 99, threshold: "7:38"}, {score: 98, threshold: "7:45"}, {score: 97, threshold: "7:52"}, {score: 96, threshold: "7:59"}, {score: 95, threshold: "8:05"}, {score: 94, threshold: "8:11"}, {score: 93, threshold: "8:16"}, {score: 92, threshold: "8:21"}, {score: 91, threshold: "8:28"}, {score: 90, threshold: "8:36"}, {score: 89, threshold: "8:42"}, {score: 88, threshold: "8:48"}, {score: 87, threshold: "8:56"}, {score: 86, threshold: "9:02"}, {score: 85, threshold: "9:09"}, {score: 84, threshold: "9:16"}, {score: 83, threshold: "9:21"}, {score: 82, threshold: "9:28"}, {score: 81, threshold: "9:35"}, {score: 80, threshold: "9:42"}, {score: 79, threshold: "9:52"}, {score: 78, threshold: "10:02"}, {score: 77, threshold: "10:14"}, {score: 76, threshold: "10:22"}, {score: 75, threshold: "10:30"}, {score: 74, threshold: "10:39"}, {score: 73, threshold: "10:48"}, {score: 72, threshold: "10:59"}, {score: 71, threshold: "11:10"}, {score: 70, threshold: "11:20"}, {score: 69, threshold: "11:30"}, {score: 68, threshold: "11:40"}, {score: 67, threshold: "11:55"}, {score: 66, threshold: "12:10"}, {score: 65, threshold: "12:20"}, {score: 64, threshold: "12:30"}, {score: 63, threshold: "12:40"}, {score: 62, threshold: "12:55"}, {score: 61, threshold: "13:10"}, {score: 60, threshold: "13:25"}, {score: 59, threshold: "13:40"}, {score: 58, threshold: "13:55"}, {score: 57, threshold: "14:15"}, {score: 56, threshold: "14:40"}, {score: 55, threshold: "15:10"}, {score: 54, threshold: "15:20"}, {score: 53, threshold: "15:30"}, {score: 52, threshold: "15:40"}, {score: 51, threshold: "15:50"}, {score: 50, threshold: "16:00"} ] },
            "ריצת 80 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 10.25}, {score: 99, threshold: 10.30}, {score: 98, threshold: 10.35}, {score: 97, threshold: 10.40}, {score: 96, threshold: 10.45}, {score: 95, threshold: 10.50}, {score: 94, threshold: 10.55}, {score: 93, threshold: 10.60}, {score: 92, threshold: 10.65}, {score: 91, threshold: 10.70}, {score: 90, threshold: 10.75}, {score: 89, threshold: 10.80}, {score: 88, threshold: 10.85}, {score: 87, threshold: 10.90}, {score: 86, threshold: 10.95}, {score: 85, threshold: 11.00}, {score: 84, threshold: 11.05}, {score: 83, threshold: 11.10}, {score: 82, threshold: 11.15}, {score: 81, threshold: 11.20}, {score: 80, threshold: 11.25}, {score: 79, threshold: 11.30}, {score: 78, threshold: 11.35}, {score: 77, threshold: 11.40}, {score: 76, threshold: 11.45}, {score: 75, threshold: 11.50}, {score: 74, threshold: 11.55}, {score: 73, threshold: 11.60}, {score: 72, threshold: 11.65}, {score: 71, threshold: 11.70}, {score: 70, threshold: 11.75}, {score: 69, threshold: 11.80}, {score: 68, threshold: 11.85}, {score: 67, threshold: 11.90}, {score: 66, threshold: 11.95}, {score: 65, threshold: 12.00}, {score: 64, threshold: 12.05}, {score: 63, threshold: 12.10}, {score: 62, threshold: 12.15}, {score: 61, threshold: 12.20}, {score: 60, threshold: 12.25}, {score: 59, threshold: 12.30}, {score: 58, threshold: 12.35}, {score: 57, threshold: 12.40}, {score: 56, threshold: 12.45}, {score: 55, threshold: 12.50}, {score: 54, threshold: 12.55}, {score: 53, threshold: 12.60}, {score: 52, threshold: 12.65}, {score: 51, threshold: 12.70}, {score: 50, threshold: 12.75} ] },
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 9.3}, {score: 99, threshold: 9.4}, {score: 98, threshold: 9.5}, {score: 97, threshold: 9.6}, {score: 96, threshold: 9.7}, {score: 95, threshold: 9.8}, {score: 94, threshold: 9.9}, {score: 93, threshold: 10.0}, {score: 92, threshold: 10.1}, {score: 91, threshold: 10.2}, {score: 90, threshold: 10.3}, {score: 89, threshold: 10.4}, {score: 88, threshold: 10.5}, {score: 87, threshold: 10.6}, {score: 86, threshold: 10.7}, {score: 85, threshold: 10.8}, {score: 84, threshold: 10.9}, {score: 83, threshold: 11.0}, {score: 82, threshold: 11.1}, {score: 81, threshold: 11.2}, {score: 80, threshold: 11.3}, {score: 79, threshold: 11.4}, {score: 78, threshold: 11.5}, {score: 77, threshold: 11.6}, {score: 76, threshold: 11.7}, {score: 75, threshold: 11.8}, {score: 74, threshold: 11.9}, {score: 73, threshold: 12.0}, {score: 72, threshold: 12.1}, {score: 71, threshold: 12.2}, {score: 70, threshold: 12.3}, {score: 69, threshold: 12.4}, {score: 68, threshold: 12.5}, {score: 67, threshold: 12.6}, {score: 66, threshold: 12.7}, {score: 65, threshold: 12.8}, {score: 64, threshold: 12.9}, {score: 63, threshold: 13.0}, {score: 62, threshold: 13.1}, {score: 61, threshold: 13.2}, {score: 60, threshold: 13.3}, {score: 59, threshold: 13.4}, {score: 58, threshold: 13.5}, {score: 57, threshold: 13.6}, {score: 56, threshold: 13.7}, {score: 55, threshold: 13.8}, {score: 54, threshold: 14.0}, {score: 53, threshold: 14.2}, {score: 52, threshold: 14.6}, {score: 51, threshold: 14.8}, {score: 50, threshold: 15.0} ] },
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 230}, {score: 99, threshold: 228}, {score: 98, threshold: 226}, {score: 97, threshold: 224}, {score: 96, threshold: 222}, {score: 95, threshold: 220}, {score: 94, threshold: 218}, {score: 93, threshold: 216}, {score: 92, threshold: 214}, {score: 91, threshold: 212}, {score: 90, threshold: 210}, {score: 89, threshold: 208}, {score: 88, threshold: 206}, {score: 87, threshold: 204}, {score: 86, threshold: 202}, {score: 85, threshold: 200}, {score: 84, threshold: 198}, {score: 83, threshold: 196}, {score: 82, threshold: 194}, {score: 81, threshold: 192}, {score: 80, threshold: 190}, {score: 79, threshold: 188}, {score: 78, threshold: 186}, {score: 77, threshold: 184}, {score: 76, threshold: 182}, {score: 75, threshold: 180}, {score: 74, threshold: 178}, {score: 73, threshold: 176}, {score: 72, threshold: 174}, {score: 71, threshold: 172}, {score: 70, threshold: 170}, {score: 69, threshold: 168}, {score: 68, threshold: 166}, {score: 67, threshold: 164}, {score: 66, threshold: 162}, {score: 65, threshold: 160}, {score: 64, threshold: 157}, {score: 63, threshold: 154}, {score: 62, threshold: 151}, {score: 61, threshold: 147}, {score: 60, threshold: 144}, {score: 59, threshold: 141}, {score: 58, threshold: 138}, {score: 57, threshold: 134}, {score: 56, threshold: 129}, {score: 55, threshold: 125}, {score: 54, threshold: 121}, {score: 53, threshold: 117}, {score: 52, threshold: 113}, {score: 51, threshold: 109}, {score: 50, threshold: 105} ] },
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 85}, {score: 99, threshold: 84}, {score: 98, threshold: 83}, {score: 97, threshold: 82}, {score: 96, threshold: 81}, {score: 95, threshold: 80}, {score: 94, threshold: 79}, {score: 93, threshold: 78}, {score: 92, threshold: 77}, {score: 91, threshold: 76}, {score: 90, threshold: 75}, {score: 89, threshold: 74}, {score: 88, threshold: 73}, {score: 87, threshold: 72}, {score: 86, threshold: 71}, {score: 85, threshold: 70}, {score: 84, threshold: 69}, {score: 83, threshold: 68}, {score: 82, threshold: 67}, {score: 81, threshold: 65}, {score: 80, threshold: 64}, {score: 79, threshold: 63}, {score: 78, threshold: 62}, {score: 77, threshold: 61}, {score: 76, threshold: 60}, {score: 75, threshold: 59}, {score: 74, threshold: 58}, {score: 73, threshold: 57}, {score: 72, threshold: 56}, {score: 71, threshold: 55}, {score: 70, threshold: 54}, {score: 69, threshold: 53}, {score: 68, threshold: 52}, {score: 67, threshold: 51}, {score: 66, threshold: 50}, {score: 65, threshold: 48}, {score: 64, threshold: 46}, {score: 63, threshold: 44}, {score: 62, threshold: 42}, {score: 61, threshold: 40}, {score: 60, threshold: 38}, {score: 59, threshold: 36}, {score: 58, threshold: 34}, {score: 57, threshold: 32}, {score: 56, threshold: 31}, {score: 55, threshold: 30}, {score: 54, threshold: 29}, {score: 53, threshold: 28}, {score: 52, threshold: 27}, {score: 51, threshold: 26}, {score: 50, threshold: 25} ] },
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 17}, {score: 98, threshold: 16}, {score: 95, threshold: 15}, {score: 92, threshold: 14}, {score: 89, threshold: 13}, {score: 86, threshold: 12}, {score: 83, threshold: 11}, {score: 80, threshold: 10}, {score: 77, threshold: 9}, {score: 74, threshold: 8}, {score: 71, threshold: 7}, {score: 68, threshold: 6}, {score: 65, threshold: 5}, {score: 62, threshold: 4}, {score: 58, threshold: 3}, {score: 55, threshold: 2}, {score: 50, threshold: 1} ] },
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 145}, {score: 99, threshold: 143}, {score: 98, threshold: 141}, {score: 97, threshold: 139}, {score: 96, threshold: 137}, {score: 95, threshold: 135}, {score: 94, threshold: 133}, {score: 93, threshold: 131}, {score: 92, threshold: 129}, {score: 91, threshold: 127}, {score: 90, threshold: 125}, {score: 89, threshold: 123}, {score: 88, threshold: 121}, {score: 87, threshold: 119}, {score: 86, threshold: 117}, {score: 85, threshold: 115}, {score: 84, threshold: 114}, {score: 83, threshold: 112}, {score: 82, threshold: 110}, {score: 81, threshold: 108}, {score: 80, threshold: 106}, {score: 79, threshold: 104}, {score: 78, threshold: 102}, {score: 77, threshold: 100}, {score: 76, threshold: 99}, {score: 75, threshold: 98}, {score: 74, threshold: 97}, {score: 73, threshold: 96}, {score: 72, threshold: 95}, {score: 71, threshold: 94}, {score: 70, threshold: 93}, {score: 69, threshold: 90}, {score: 68, threshold: 88}, {score: 67, threshold: 86}, {score: 66, threshold: 84}, {score: 65, threshold: 82}, {score: 64, threshold: 80}, {score: 63, threshold: 78}, {score: 62, threshold: 76}, {score: 61, threshold: 74}, {score: 60, threshold: 72}, {score: 59, threshold: 70}, {score: 58, threshold: 69}, {score: 57, threshold: 67}, {score: 56, threshold: 66}, {score: 55, threshold: 65}, {score: 54, threshold: 64}, {score: 53, threshold: 63}, {score: 52, threshold: 62}, {score: 51, threshold: 61}, {score: 50, threshold: 60} ] }
        },
        "יא": {
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "7:10"}, {score: 99, threshold: "7:18"}, {score: 98, threshold: "7:25"}, {score: 97, threshold: "7:32"}, {score: 96, threshold: "7:39"}, {score: 95, threshold: "7:45"}, {score: 94, threshold: "7:52"}, {score: 93, threshold: "7:59"}, {score: 92, threshold: "8:05"}, {score: 91, threshold: "8:12"}, {score: 90, threshold: "8:22"}, {score: 89, threshold: "8:29"}, {score: 88, threshold: "8:38"}, {score: 87, threshold: "8:46"}, {score: 86, threshold: "8:53"}, {score: 85, threshold: "9:00"}, {score: 84, threshold: "9:07"}, {score: 83, threshold: "9:14"}, {score: 82, threshold: "9:21"}, {score: 81, threshold: "9:28"}, {score: 80, threshold: "9:35"}, {score: 79, threshold: "9:45"}, {score: 78, threshold: "9:55"}, {score: 77, threshold: "10:05"}, {score: 76, threshold: "10:15"}, {score: 75, threshold: "10:25"}, {score: 74, threshold: "10:35"}, {score: 73, threshold: "10:45"}, {score: 72, threshold: "10:55"}, {score: 71, threshold: "11:05"}, {score: 70, threshold: "11:15"}, {score: 69, threshold: "11:25"}, {score: 68, threshold: "11:35"}, {score: 67, threshold: "11:50"}, {score: 66, threshold: "12:05"}, {score: 65, threshold: "12:20"}, {score: 64, threshold: "12:35"}, {score: 63, threshold: "12:50"}, {score: 62, threshold: "13:05"}, {score: 61, threshold: "13:25"}, {score: 60, threshold: "13:45"}, {score: 59, threshold: "14:00"}, {score: 58, threshold: "14:20"}, {score: 57, threshold: "14:35"}, {score: 56, threshold: "14:50"}, {score: 55, threshold: "15:00"}, {score: 54, threshold: "15:20"}, {score: 53, threshold: "15:35"}, {score: 52, threshold: "15:50"}, {score: 51, threshold: "16:00"}, {score: 50, threshold: "16:10"} ] },
            "ריצת 80 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 10.10}, {score: 99, threshold: 10.15}, {score: 98, threshold: 10.20}, {score: 97, threshold: 10.25}, {score: 96, threshold: 10.30}, {score: 95, threshold: 10.35}, {score: 94, threshold: 10.40}, {score: 93, threshold: 10.45}, {score: 92, threshold: 10.50}, {score: 91, threshold: 10.55}, {score: 90, threshold: 10.60}, {score: 89, threshold: 10.65}, {score: 88, threshold: 10.70}, {score: 87, threshold: 10.75}, {score: 86, threshold: 10.80}, {score: 85, threshold: 10.85}, {score: 84, threshold: 10.90}, {score: 83, threshold: 10.95}, {score: 82, threshold: 11.00}, {score: 81, threshold: 11.05}, {score: 80, threshold: 11.10}, {score: 79, threshold: 11.15}, {score: 78, threshold: 11.20}, {score: 77, threshold: 11.25}, {score: 76, threshold: 11.30}, {score: 75, threshold: 11.35}, {score: 74, threshold: 11.40}, {score: 73, threshold: 11.45}, {score: 72, threshold: 11.50}, {score: 71, threshold: 11.55}, {score: 70, threshold: 11.60}, {score: 69, threshold: 11.65}, {score: 68, threshold: 11.70}, {score: 67, threshold: 11.75}, {score: 66, threshold: 11.80}, {score: 65, threshold: 11.85}, {score: 64, threshold: 11.90}, {score: 63, threshold: 11.95}, {score: 62, threshold: 12.00}, {score: 61, threshold: 12.05}, {score: 60, threshold: 12.10}, {score: 59, threshold: 12.15}, {score: 58, threshold: 12.20}, {score: 57, threshold: 12.25}, {score: 56, threshold: 12.30}, {score: 55, threshold: 12.35}, {score: 54, threshold: 12.40}, {score: 53, threshold: 12.45}, {score: 52, threshold: 12.50}, {score: 51, threshold: 12.55}, {score: 50, threshold: 12.60} ] },
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 9.0}, {score: 99, threshold: 9.1}, {score: 98, threshold: 9.2}, {score: 97, threshold: 9.3}, {score: 96, threshold: 9.4}, {score: 95, threshold: 9.5}, {score: 94, threshold: 9.6}, {score: 93, threshold: 9.7}, {score: 92, threshold: 9.8}, {score: 91, threshold: 9.9}, {score: 90, threshold: 10.0}, {score: 89, threshold: 10.1}, {score: 88, threshold: 10.2}, {score: 87, threshold: 10.3}, {score: 86, threshold: 10.4}, {score: 85, threshold: 10.5}, {score: 84, threshold: 10.6}, {score: 83, threshold: 10.7}, {score: 82, threshold: 10.8}, {score: 81, threshold: 10.9}, {score: 80, threshold: 11.0}, {score: 79, threshold: 11.1}, {score: 78, threshold: 11.2}, {score: 77, threshold: 11.3}, {score: 76, threshold: 11.4}, {score: 75, threshold: 11.5}, {score: 74, threshold: 11.6}, {score: 73, threshold: 11.7}, {score: 72, threshold: 11.8}, {score: 71, threshold: 11.9}, {score: 70, threshold: 12.0}, {score: 69, threshold: 12.1}, {score: 68, threshold: 12.2}, {score: 67, threshold: 12.3}, {score: 66, threshold: 12.4}, {score: 65, threshold: 12.5}, {score: 64, threshold: 12.6}, {score: 63, threshold: 12.7}, {score: 62, threshold: 12.8}, {score: 61, threshold: 12.9}, {score: 60, threshold: 13.0}, {score: 59, threshold: 13.1}, {score: 58, threshold: 13.2}, {score: 57, threshold: 13.3}, {score: 56, threshold: 13.4}, {score: 55, threshold: 13.5}, {score: 54, threshold: 13.6}, {score: 53, threshold: 13.7}, {score: 52, threshold: 13.8}, {score: 51, threshold: 13.9}, {score: 50, threshold: 14.0} ] },
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 240}, {score: 99, threshold: 238}, {score: 98, threshold: 236}, {score: 97, threshold: 234}, {score: 96, threshold: 232}, {score: 95, threshold: 230}, {score: 94, threshold: 228}, {score: 93, threshold: 226}, {score: 92, threshold: 224}, {score: 91, threshold: 222}, {score: 90, threshold: 200}, {score: 89, threshold: 198}, {score: 88, threshold: 196}, {score: 87, threshold: 194}, {score: 86, threshold: 192}, {score: 85, threshold: 190}, {score: 84, threshold: 188}, {score: 83, threshold: 186}, {score: 82, threshold: 184}, {score: 81, threshold: 182}, {score: 80, threshold: 180}, {score: 79, threshold: 178}, {score: 78, threshold: 176}, {score: 77, threshold: 174}, {score: 76, threshold: 172}, {score: 75, threshold: 170}, {score: 74, threshold: 168}, {score: 73, threshold: 166}, {score: 72, threshold: 164}, {score: 71, threshold: 162}, {score: 70, threshold: 160}, {score: 69, threshold: 157}, {score: 68, threshold: 154}, {score: 67, threshold: 152}, {score: 66, threshold: 150}, {score: 65, threshold: 148}, {score: 64, threshold: 146}, {score: 63, threshold: 144}, {score: 62, threshold: 143}, {score: 61, threshold: 142}, {score: 60, threshold: 141}, {score: 59, threshold: 140}, {score: 58, threshold: 138}, {score: 57, threshold: 137}, {score: 56, threshold: 136}, {score: 55, threshold: 135}, {score: 54, threshold: 132}, {score: 53, threshold: 130}, {score: 52, threshold: 128}, {score: 51, threshold: 126}, {score: 50, threshold: 124} ] },
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 90}, {score: 99, threshold: 89}, {score: 98, threshold: 88}, {score: 97, threshold: 87}, {score: 96, threshold: 86}, {score: 95, threshold: 85}, {score: 94, threshold: 84}, {score: 93, threshold: 83}, {score: 92, threshold: 82}, {score: 91, threshold: 81}, {score: 90, threshold: 80}, {score: 89, threshold: 79}, {score: 88, threshold: 78}, {score: 87, threshold: 77}, {score: 86, threshold: 76}, {score: 85, threshold: 75}, {score: 84, threshold: 74}, {score: 83, threshold: 73}, {score: 82, threshold: 72}, {score: 81, threshold: 70}, {score: 80, threshold: 69}, {score: 79, threshold: 68}, {score: 78, threshold: 67}, {score: 77, threshold: 66}, {score: 76, threshold: 65}, {score: 75, threshold: 64}, {score: 74, threshold: 63}, {score: 73, threshold: 61}, {score: 72, threshold: 60}, {score: 71, threshold: 59}, {score: 70, threshold: 58}, {score: 69, threshold: 57}, {score: 68, threshold: 56}, {score: 67, threshold: 54}, {score: 66, threshold: 52}, {score: 65, threshold: 50}, {score: 64, threshold: 48}, {score: 63, threshold: 46}, {score: 62, threshold: 45}, {score: 61, threshold: 44}, {score: 60, threshold: 43}, {score: 59, threshold: 41}, {score: 58, threshold: 39}, {score: 57, threshold: 37}, {score: 56, threshold: 35}, {score: 55, threshold: 33}, {score: 54, threshold: 31}, {score: 53, threshold: 29}, {score: 52, threshold: 27}, {score: 51, threshold: 25}, {score: 50, threshold: 23} ] },
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 20}, {score: 98, threshold: 19}, {score: 96, threshold: 18}, {score: 94, threshold: 17}, {score: 92, threshold: 16}, {score: 89, threshold: 15}, {score: 86, threshold: 14}, {score: 83, threshold: 13}, {score: 80, threshold: 12}, {score: 77, threshold: 11}, {score: 74, threshold: 10}, {score: 71, threshold: 9}, {score: 68, threshold: 8}, {score: 65, threshold: 7}, {score: 62, threshold: 6}, {score: 59, threshold: 5}, {score: 57, threshold: 4}, {score: 55, threshold: 3}, {score: 53, threshold: 2}, {score: 51, threshold: 1}, {score: 50, threshold: 0} ] },
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 150}, {score: 99, threshold: 148}, {score: 98, threshold: 146}, {score: 97, threshold: 144}, {score: 96, threshold: 142}, {score: 95, threshold: 140}, {score: 94, threshold: 138}, {score: 93, threshold: 136}, {score: 92, threshold: 134}, {score: 91, threshold: 132}, {score: 90, threshold: 130}, {score: 89, threshold: 128}, {score: 88, threshold: 126}, {score: 87, threshold: 124}, {score: 86, threshold: 122}, {score: 85, threshold: 120}, {score: 84, threshold: 119}, {score: 83, threshold: 117}, {score: 82, threshold: 115}, {score: 81, threshold: 113}, {score: 80, threshold: 111}, {score: 79, threshold: 109}, {score: 78, threshold: 107}, {score: 77, threshold: 105}, {score: 76, threshold: 103}, {score: 75, threshold: 101}, {score: 74, threshold: 100}, {score: 73, threshold: 99}, {score: 72, threshold: 98}, {score: 71, threshold: 97}, {score: 70, threshold: 96}, {score: 69, threshold: 95}, {score: 68, threshold: 94}, {score: 67, threshold: 92}, {score: 66, threshold: 90}, {score: 65, threshold: 89}, {score: 64, threshold: 88}, {score: 63, threshold: 87}, {score: 62, threshold: 86}, {score: 61, threshold: 85}, {score: 60, threshold: 83}, {score: 59, threshold: 80}, {score: 58, threshold: 77}, {score: 57, threshold: 75}, {score: 56, threshold: 72}, {score: 55, threshold: 70}, {score: 54, threshold: 69}, {score: 53, threshold: 68}, {score: 52, threshold: 67}, {score: 51, threshold: 66}, {score: 50, threshold: 65} ] }
        },
        "יב": {
            "ריצת 2000 מטר": { unit: "דקות", isTime: true, lowerIsBetter: true, grades: [ {score: 100, threshold: "7:00"}, {score: 99, threshold: "7:08"}, {score: 98, threshold: "7:16"}, {score: 97, threshold: "7:22"}, {score: 96, threshold: "7:30"}, {score: 95, threshold: "7:38"}, {score: 94, threshold: "7:46"}, {score: 93, threshold: "7:55"}, {score: 92, threshold: "8:04"}, {score: 91, threshold: "8:12"}, {score: 90, threshold: "8:19"}, {score: 89, threshold: "8:28"}, {score: 88, threshold: "8:36"}, {score: 87, threshold: "8:45"}, {score: 86, threshold: "8:53"}, {score: 85, threshold: "9:00"}, {score: 84, threshold: "9:08"}, {score: 83, threshold: "9:17"}, {score: 82, threshold: "9:26"}, {score: 81, threshold: "9:35"}, {score: 80, threshold: "9:44"}, {score: 79, threshold: "9:53"}, {score: 78, threshold: "10:00"}, {score: 77, threshold: "10:10"}, {score: 76, threshold: "10:20"}, {score: 75, threshold: "10:30"}, {score: 74, threshold: "10:40"}, {score: 73, threshold: "10:50"}, {score: 72, threshold: "11:00"}, {score: 71, threshold: "11:10"}, {score: 70, threshold: "11:20"}, {score: 69, threshold: "11:30"}, {score: 68, threshold: "11:40"}, {score: 67, threshold: "11:50"}, {score: 66, threshold: "12:00"}, {score: 65, threshold: "12:10"}, {score: 64, threshold: "12:20"}, {score: 63, threshold: "12:30"}, {score: 62, threshold: "12:40"}, {score: 61, threshold: "12:50"}, {score: 60, threshold: "13:00"}, {score: 59, threshold: "13:20"}, {score: 58, threshold: "13:40"}, {score: 57, threshold: "14:00"}, {score: 56, threshold: "14:25"}, {score: 55, threshold: "14:50"}, {score: 54, threshold: "15:10"}, {score: 53, threshold: "15:25"}, {score: 52, threshold: "15:40"}, {score: 51, threshold: "15:55"}, {score: 50, threshold: "16:10"} ] },
            "ריצת 80 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 10.00}, {score: 99, threshold: 10.05}, {score: 98, threshold: 10.10}, {score: 97, threshold: 10.15}, {score: 96, threshold: 10.20}, {score: 95, threshold: 10.25}, {score: 94, threshold: 10.30}, {score: 93, threshold: 10.35}, {score: 92, threshold: 10.40}, {score: 91, threshold: 10.45}, {score: 90, threshold: 10.50}, {score: 89, threshold: 10.55}, {score: 88, threshold: 10.60}, {score: 87, threshold: 10.65}, {score: 86, threshold: 10.70}, {score: 85, threshold: 10.75}, {score: 84, threshold: 10.80}, {score: 83, threshold: 10.85}, {score: 82, threshold: 10.90}, {score: 81, threshold: 10.95}, {score: 80, threshold: 11.00}, {score: 79, threshold: 11.05}, {score: 78, threshold: 11.10}, {score: 77, threshold: 11.15}, {score: 76, threshold: 11.20}, {score: 75, threshold: 11.25}, {score: 74, threshold: 11.30}, {score: 73, threshold: 11.35}, {score: 72, threshold: 11.40}, {score: 71, threshold: 11.45}, {score: 70, threshold: 11.50}, {score: 69, threshold: 11.55}, {score: 68, threshold: 11.60}, {score: 67, threshold: 11.65}, {score: 66, threshold: 11.70}, {score: 65, threshold: 11.75}, {score: 64, threshold: 11.80}, {score: 63, threshold: 11.85}, {score: 62, threshold: 11.90}, {score: 61, threshold: 11.95}, {score: 60, threshold: 12.00}, {score: 59, threshold: 12.05}, {score: 58, threshold: 12.10}, {score: 57, threshold: 12.15}, {score: 56, threshold: 12.20}, {score: 55, threshold: 12.25}, {score: 54, threshold: 12.30}, {score: 53, threshold: 12.35}, {score: 52, threshold: 12.40}, {score: 51, threshold: 12.45}, {score: 50, threshold: 12.50} ] },
            "ריצת 4x10 מטר": { unit: "שניות", lowerIsBetter: true, grades: [ {score: 100, threshold: 8.7}, {score: 99, threshold: 8.8}, {score: 98, threshold: 8.9}, {score: 97, threshold: 9.0}, {score: 96, threshold: 9.1}, {score: 95, threshold: 9.2}, {score: 94, threshold: 9.3}, {score: 93, threshold: 9.4}, {score: 92, threshold: 9.5}, {score: 91, threshold: 9.6}, {score: 90, threshold: 9.7}, {score: 89, threshold: 9.8}, {score: 88, threshold: 9.9}, {score: 87, threshold: 10.0}, {score: 86, threshold: 10.1}, {score: 85, threshold: 10.2}, {score: 84, threshold: 10.3}, {score: 83, threshold: 10.4}, {score: 82, threshold: 10.5}, {score: 81, threshold: 10.6}, {score: 80, threshold: 10.7}, {score: 79, threshold: 10.8}, {score: 78, threshold: 10.9}, {score: 77, threshold: 11.0}, {score: 76, threshold: 11.1}, {score: 75, threshold: 11.2}, {score: 74, threshold: 11.3}, {score: 73, threshold: 11.4}, {score: 72, threshold: 11.5}, {score: 71, threshold: 11.6}, {score: 70, threshold: 11.7}, {score: 69, threshold: 11.8}, {score: 68, threshold: 11.9}, {score: 67, threshold: 12.0}, {score: 66, threshold: 12.1}, {score: 65, threshold: 12.2}, {score: 64, threshold: 12.3}, {score: 63, threshold: 12.4}, {score: 62, threshold: 12.5}, {score: 61, threshold: 12.6}, {score: 60, threshold: 12.7}, {score: 59, threshold: 12.8}, {score: 58, threshold: 12.9}, {score: 57, threshold: 13.0}, {score: 56, threshold: 13.1}, {score: 55, threshold: 13.2}, {score: 54, threshold: 13.3}, {score: 53, threshold: 13.4}, {score: 52, threshold: 13.5}, {score: 51, threshold: 13.6}, {score: 50, threshold: 13.7} ] },
            "קפיצה למרחק מהמקום": { unit: "ס\"מ", lowerIsBetter: false, grades: [ {score: 100, threshold: 245}, {score: 99, threshold: 243}, {score: 98, threshold: 241}, {score: 97, threshold: 239}, {score: 96, threshold: 237}, {score: 95, threshold: 235}, {score: 94, threshold: 233}, {score: 93, threshold: 231}, {score: 92, threshold: 229}, {score: 91, threshold: 227}, {score: 90, threshold: 225}, {score: 89, threshold: 223}, {score: 88, threshold: 221}, {score: 87, threshold: 219}, {score: 86, threshold: 217}, {score: 85, threshold: 215}, {score: 84, threshold: 213}, {score: 83, threshold: 211}, {score: 82, threshold: 209}, {score: 81, threshold: 207}, {score: 80, threshold: 205}, {score: 79, threshold: 203}, {score: 78, threshold: 201}, {score: 77, threshold: 199}, {score: 76, threshold: 197}, {score: 75, threshold: 195}, {score: 74, threshold: 193}, {score: 73, threshold: 191}, {score: 72, threshold: 189}, {score: 71, threshold: 187}, {score: 70, threshold: 185}, {score: 69, threshold: 182}, {score: 68, threshold: 180}, {score: 67, threshold: 177}, {score: 66, threshold: 174}, {score: 65, threshold: 171}, {score: 64, threshold: 168}, {score: 63, threshold: 165}, {score: 62, threshold: 162}, {score: 61, threshold: 159}, {score: 60, threshold: 156}, {score: 59, threshold: 152}, {score: 58, threshold: 148}, {score: 57, threshold: 145}, {score: 56, threshold: 142}, {score: 55, threshold: 140}, {score: 54, threshold: 138}, {score: 53, threshold: 136}, {score: 52, threshold: 134}, {score: 51, threshold: 132}, {score: 50, threshold: 130} ] },
            "כפיפות בטן": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 95}, {score: 99, threshold: 94}, {score: 98, threshold: 93}, {score: 97, threshold: 92}, {score: 96, threshold: 91}, {score: 95, threshold: 90}, {score: 94, threshold: 89}, {score: 93, threshold: 88}, {score: 92, threshold: 87}, {score: 91, threshold: 86}, {score: 90, threshold: 85}, {score: 89, threshold: 84}, {score: 88, threshold: 83}, {score: 87, threshold: 82}, {score: 86, threshold: 81}, {score: 85, threshold: 80}, {score: 79, threshold: 74}, {score: 78, threshold: 73}, {score: 77, threshold: 72}, {score: 76, threshold: 71}, {score: 75, threshold: 70}, {score: 74, threshold: 68}, {score: 73, threshold: 67}, {score: 72, threshold: 66}, {score: 71, threshold: 65}, {score: 70, threshold: 64}, {score: 69, threshold: 63}, {score: 68, threshold: 62}, {score: 67, threshold: 61}, {score: 66, threshold: 60}, {score: 65, threshold: 58}, {score: 64, threshold: 56}, {score: 63, threshold: 54}, {score: 62, threshold: 52}, {score: 61, threshold: 50}, {score: 60, threshold: 48}, {score: 59, threshold: 46}, {score: 58, threshold: 44}, {score: 57, threshold: 41}, {score: 56, threshold: 38}, {score: 55, threshold: 35}, {score: 54, threshold: 34}, {score: 53, threshold: 33}, {score: 52, threshold: 32}, {score: 51, threshold: 31}, {score: 50, threshold: 30} ] },
            "מתח": { unit: "חזרות", lowerIsBetter: false, grades: [ {score: 100, threshold: 22}, {score: 98, threshold: 20}, {score: 96, threshold: 19}, {score: 95, threshold: 18}, {score: 93, threshold: 17}, {score: 91, threshold: 16}, {score: 88, threshold: 15}, {score: 85, threshold: 14}, {score: 82, threshold: 13}, {score: 79, threshold: 12}, {score: 76, threshold: 11}, {score: 73, threshold: 10}, {score: 70, threshold: 9}, {score: 67, threshold: 8}, {score: 64, threshold: 7}, {score: 61, threshold: 6}, {score: 58, threshold: 5}, {score: 55, threshold: 4}, {score: 54, threshold: 3}, {score: 52, threshold: 2}, {score: 50, threshold: 1} ] },
            "דילגית": { unit: "קפיצות", lowerIsBetter: false, grades: [ {score: 100, threshold: 155}, {score: 99, threshold: 153}, {score: 98, threshold: 151}, {score: 97, threshold: 149}, {score: 96, threshold: 147}, {score: 95, threshold: 145}, {score: 94, threshold: 143}, {score: 93, threshold: 141}, {score: 92, threshold: 139}, {score: 91, threshold: 137}, {score: 90, threshold: 135}, {score: 89, threshold: 133}, {score: 88, threshold: 131}, {score: 87, threshold: 129}, {score: 86, threshold: 127}, {score: 85, threshold: 125}, {score: 84, threshold: 124}, {score: 83, threshold: 122}, {score: 82, threshold: 120}, {score: 81, threshold: 118}, {score: 80, threshold: 116}, {score: 79, threshold: 114}, {score: 78, threshold: 112}, {score: 77, threshold: 110}, {score: 76, threshold: 108}, {score: 75, threshold: 106}, {score: 74, threshold: 104}, {score: 73, threshold: 102}, {score: 72, threshold: 101}, {score: 71, threshold: 100}, {score: 70, threshold: 99}, {score: 69, threshold: 98}, {score: 68, threshold: 97}, {score: 67, threshold: 96}, {score: 66, threshold: 95}, {score: 65, threshold: 94}, {score: 64, threshold: 93}, {score: 63, threshold: 92}, {score: 62, threshold: 90}, {score: 61, threshold: 87}, {score: 60, threshold: 84}, {score: 59, threshold: 81}, {score: 58, threshold: 78}, {score: 57, threshold: 77}, {score: 56, threshold: 76}, {score: 55, threshold: 75}, {score: 54, threshold: 74}, {score: 53, threshold: 73}, {score: 52, threshold: 72}, {score: 51, threshold: 71}, {score: 50, threshold: 70} ] }
        }
    }
};

// --- Helper Functions ---
const parseTimeToSeconds = (timeStr) => {
    const parts = String(timeStr).split(/[:.]/);
    if (parts.length === 2) {
        const minutes = parseInt(parts[0], 10);
        const seconds = parseInt(parts[1], 10);
        if (!isNaN(minutes) && !isNaN(seconds)) {
            return (minutes * 60) + seconds;
        }
    }
    return parseFloat(timeStr);
};

const calculateGrade = (gender, grade, testType, result) => {
    const testInfo = GRADING_DATA[gender]?.[grade]?.[testType];
    if (!testInfo || !testInfo.grades || testInfo.grades.length === 0) return 0;

    const { grades, lowerIsBetter, isTime } = testInfo;
    const numericResult = isTime ? parseTimeToSeconds(result) : parseFloat(result);
    if (isNaN(numericResult)) return 0;

    if (lowerIsBetter) {
        // Find the best score for which the result is good enough (less than or equal to the threshold)
        for (const gradeInfo of grades) {
            const thresholdValue = isTime ? parseTimeToSeconds(gradeInfo.threshold) : gradeInfo.threshold;
            if (numericResult <= thresholdValue) {
                return gradeInfo.score;
            }
        }
        return 50; // Or some base score if result is worse than all thresholds
    } else { // higherIsBetter
        // Find the best score for which the result is good enough (greater than or equal to the threshold)
        for (const gradeInfo of grades) {
            const thresholdValue = isTime ? parseTimeToSeconds(gradeInfo.threshold) : gradeInfo.threshold;
            if (numericResult >= thresholdValue) {
                return gradeInfo.score;
            }
        }
    }
    return 50; // If no score was matched (e.g., result is worse than the lowest threshold)
};

const getGradeColor = (grade) => {
    if (grade >= 90) return 'text-green-600';
    if (grade < 65) return 'text-red-700';
    return 'text-slate-800';
};

const callGemini = async (prompt) => {
    const apiKey = ""; // Handled by environment
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        if (!response.ok) {
            const errorBody = await response.text();
            throw new Error(`API call failed: ${response.status}. Body: ${errorBody}`);
        }
        const result = await response.json();
        if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
            return result.candidates[0].content.parts[0].text;
        }
        return "לא התקבלה תשובה מהמודל.";
    } catch (error) {
        console.error("Gemini API call error:", error);
        return "שגיאה ביצירת התשובה.";
    }
};


export default function App() {
    // --- STATE MANAGEMENT ---
    // Form State
    const [gender, setGender] = useState('בנות');
    const [gradeLevel, setGradeLevel] = useState('ז');
    const [className, setClassName] = useState("ז'1");
    const [testDate, setTestDate] = useState(new Date().toISOString().split('T')[0]);
    const [testType, setTestType] = useState('');
    const [lockForm, setLockForm] = useState(false);
    const [firstName, setFirstName] = useState('');
    const [lastName, setLastName] = useState('');
    const [result, setResult] = useState('');
    const [selectedStudent, setSelectedStudent] = useState('');

    // App Data State
    const [records, setRecords] = useState([]);
    const [classRosters, setClassRosters] = useState({});
    
    // Modal State
    const [modal, setModal] = useState({ type: null, data: null }); // type: 'confirm', 'ai', 'lessonPlan', 'classManager', 'editClass'
    const [aiContent, setAiContent] = useState('');
    const [isAiLoading, setIsAiLoading] = useState(false);

    // Class Management Modal State
    const [editingClass, setEditingClass] = useState(null); // { name: 'ז'1', students: '...'}
    
    // Lesson Plan Modal State
    const [fitnessComponent, setFitnessComponent] = useState('סיבולת לב-ריאה');
    const [equipment, setEquipment] = useState('');
    const [lessonDuration, setLessonDuration] = useState('45 דקות');
    
    // Share Group Modal State
    const [classToShare, setClassToShare] = useState('');
    const [testToShare, setTestToShare] = useState('');

    // Training Plan Modal State
    const [trainingGoal, setTrainingGoal] = useState('');
    const [trainingDuration, setTrainingDuration] = useState('שבוע');

    // Report Card Modal State
    const [studentToEvaluate, setStudentToEvaluate] = useState('');


    // --- DERIVED STATE & MEMOIZATION ---
    const gradeLevelOptions = useMemo(() => (gender === 'בנים') ? ['ז', 'ח', 'ט', 'י', 'יא', 'יב'] : ['ז','ח','ט','י', 'יא', 'יב'], [gender]);
    
    const classOptions = useMemo(() => {
        const numClasses = CLASSES_PER_GRADE[gradeLevel] || 0;
        return Array.from({ length: numClasses }, (_, i) => `${gradeLevel}'${i + 1}`);
    }, [gradeLevel]);

    const testTypeOptions = useMemo(() => Object.keys(GRADING_DATA[gender]?.[gradeLevel] || {}), [gender, gradeLevel]);

    const unitDisplay = useMemo(() => {
        return GRADING_DATA[gender]?.[gradeLevel]?.[testType]?.unit || '';
    }, [gender, gradeLevel, testType]);

    const averageGrade = useMemo(() => {
        if (records.length === 0) return 0;
        const total = records.reduce((sum, r) => sum + r.grade, 0);
        return (total / records.length).toFixed(2);
    }, [records]);

    const uniqueClassesToShare = useMemo(() => [...new Set(records.map(r => r.className))].sort(), [records]);
    const uniqueTestsToShare = useMemo(() => [...new Set(records.map(r => r.testType))].sort(), [records]);
    const uniqueStudentsToEvaluate = useMemo(() => [...new Map(records.map(r => [`${r.firstName} ${r.lastName}`, r])).values()], [records]);
    
    const currentStudentList = useMemo(() => classRosters[className] || [], [classRosters, className]);


    // --- EFFECTS ---
    // Load data from localStorage on initial render
    useEffect(() => {
        try {
            const savedRecords = localStorage.getItem('pe_records');
            if (savedRecords) setRecords(JSON.parse(savedRecords));
            
            const savedRosters = localStorage.getItem('pe_class_rosters');
            if (savedRosters) setClassRosters(JSON.parse(savedRosters));

            // LTI Simulation: Check for URL parameters
            const params = new URLSearchParams(window.location.search);
            const ltiFirstName = params.get('fname');
            const ltiLastName = params.get('lname');
            if (ltiFirstName) setFirstName(ltiFirstName);
            if (ltiLastName) setLastName(ltiLastName);

        } catch (error) {
            console.error("Failed to load data from localStorage", error);
        }
    }, []);

    // Save records to localStorage whenever they change
    useEffect(() => {
        try {
            localStorage.setItem('pe_records', JSON.stringify(records));
        } catch (error) {
            console.error("Failed to save records to localStorage", error);
        }
    }, [records]);
    
    // Save class rosters to localStorage whenever they change
    useEffect(() => {
        try {
            localStorage.setItem('pe_class_rosters', JSON.stringify(classRosters));
        } catch (error) {
            console.error("Failed to save rosters to localStorage", error);
        }
    }, [classRosters]);

    useEffect(() => {
        if (!gradeLevelOptions.includes(gradeLevel)) {
            setGradeLevel(gradeLevelOptions[0]);
        }
    }, [gradeLevelOptions, gradeLevel]);

    useEffect(() => {
        if (!classOptions.includes(className)) {
            setClassName(classOptions[0] || '');
        }
        // Reset student selection when class changes
        setSelectedStudent('');
        setFirstName('');
        setLastName('');
    }, [classOptions, className]);

    useEffect(() => {
        if (!testTypeOptions.includes(testType)) {
            setTestType(testTypeOptions[0] || '');
        }
    }, [testTypeOptions, testType]);

    useEffect(() => {
        if (selectedStudent) {
            const nameParts = selectedStudent.split(' ');
            setFirstName(nameParts[0] || '');
            setLastName(nameParts.slice(1).join(' ') || '');
        } else {
            setFirstName('');
            setLastName('');
        }
    }, [selectedStudent]);


    // --- EVENT HANDLERS ---
    const handleFormSubmit = (e) => {
        e.preventDefault();
        if (!firstName.trim() || !lastName.trim() || !result.trim() || !testType) {
            alert("אנא מלא את כל השדות הנדרשים.");
            return;
        }

        const newRecord = {
            id: crypto.randomUUID(),
            firstName: firstName.trim(),
            lastName: lastName.trim(),
            gender,
            gradeLevel,
            className,
            date: testDate,
            testType,
            originalResult: result.trim(),
            grade: calculateGrade(gender, gradeLevel, testType, result.trim())
        };

        setRecords(prev => [...prev, newRecord].sort((a, b) => a.lastName.localeCompare(b.lastName)));

        // Clear only student-specific fields
        setFirstName('');
        setLastName('');
        setResult('');
        setSelectedStudent('');
        
        // Optional: focus the result field for the next entry
        document.getElementById('result')?.focus();
    };

    const handleDeleteRecord = (recordId) => {
        setModal({ 
            type: 'confirm', 
            data: { 
                title: 'אישור מחיקה', 
                message: 'האם אתה בטוח שברצונך למחוק רשומה זו?',
                onConfirm: () => {
                    setRecords(prev => prev.filter(r => r.id !== recordId));
                    setModal({ type: null, data: null });
                }
            }
        });
    };

    const handleClearAll = () => {
        if (records.length === 0) return;
        setModal({
            type: 'confirm',
            data: {
                title: 'מחיקת כל הנתונים',
                message: 'פעולה זו תמחק את כל הרשומות לצמיתות. האם להמשיך?',
                onConfirm: () => {
                    setRecords([]);
                    setModal({ type: null, data: null });
                }
            }
        });
    };

    const exportToCSV = () => {
        if (records.length === 0) {
            alert("אין נתונים לייצוא.");
            return;
        }
        const headers = ['שם פרטי', 'שם משפחה', 'מין', 'שכבה', 'כיתה', 'סוג מבחן', 'תוצאה', 'תאריך', 'ציון'];
        const rows = records.map(r => [r.firstName, r.lastName, r.gender, r.gradeLevel, r.className, r.testType, r.originalResult, new Date(r.date).toLocaleDateString('he-IL'), r.grade]);
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        csvContent += headers.join(",") + "\r\n";
        rows.forEach(rowArray => { csvContent += rowArray.join(",") + "\r\n"; });
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "ציוני_חינוך_גופני.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };
    
    const handleShareToWhatsApp = (record) => {
        const message = `היי, הנה התוצאה של ${record.firstName} ${record.lastName}:\n\n` +
                        `*מבחן:* ${record.testType}\n` +
                        `*תוצאה:* ${record.originalResult}\n` +
                        `*ציון:* ${record.grade}\n\n` +
                        `כל הכבוד על המאמץ!`;
        const encodedMessage = encodeURIComponent(message);
        window.open(`https://api.whatsapp.com/send?text=${encodedMessage}`, '_blank');
    };

    const showAiModal = (title) => {
        setAiContent('');
        setIsAiLoading(true);
        setModal({ type: 'ai', data: { title } });
    };

    const handleGenerateFeedback = async (record) => {
        showAiModal(`מפיק משוב עבור ${record.firstName}...`);
        const { unit, lowerIsBetter } = GRADING_DATA[record.gender][record.gradeLevel][record.testType];
        const performanceContext = lowerIsBetter ? "נמוך יותר הוא טוב יותר" : "גבוה יותר הוא טוב יותר";
        const prompt = `
        אתה מורה לחינוך גופני. כתוב משוב אישי, חיובי ומעודד לתלמיד/ה בשם ${record.firstName}.
        המשוב צריך להיות בעברית.
        
        פרטי המבחן:
        - שם התלמיד/ה: ${record.firstName} ${record.lastName}
        - מין: ${record.gender}
        - שם המבחן: ${record.testType}
        - התוצאה שהושגה: ${record.originalResult} ${unit}
        - הציון שנקבע: ${record.grade} מתוך 100
        - הערה: במבחן זה, ${performanceContext}.

        מבנה המשוב:
        1. פתיחה חיובית המכירה במאמץ.
        2. ניתוח קצר של התוצאה בהקשר למבחן.
        3. 2-3 טיפים פרקטיים וברורים לשיפור התוצאה בפעם הבאה, מותאמים למין התלמיד/ה במידת הצורך.
        4. סיום מעודד.

        הקפד על טון חיובי ומכבד.
        `;
        const feedback = await callGemini(prompt);
        setAiContent(feedback);
        setIsAiLoading(false);
    };
    
    const handleGenerateInsights = async () => {
        if (records.length < 3) {
             alert("יש להזין לפחות 3 רשומות כדי להפיק תובנות.");
             return;
        }
        showAiModal('מפיק תובנות כיתתיות...');

        const summaryData = {};
        records.forEach(record => {
            if (!summaryData[record.testType]) {
                summaryData[record.testType] = { grades: [], count: 0 };
            }
            summaryData[record.testType].grades.push(record.grade);
        });

        const analysis = Object.keys(summaryData).map(testType => {
            const grades = summaryData[testType].grades;
            const average = grades.reduce((a, b) => a + b, 0) / grades.length;
            return { test: testType, averageGrade: parseFloat(average.toFixed(2)), studentCount: grades.length };
        });

        const processedData = {
            overallAverageGrade: parseFloat(averageGrade),
            totalRecords: records.length,
            analysisByTest: analysis
        };

        const prompt = `
        You are an experienced physical education teacher. Analyze the following summarized fitness test data for a class and provide a concise insights report in Hebrew.

        The summarized data (JSON format):
        ${JSON.stringify(processedData, null, 2)}

        Report Structure:
        1.  **סיכום כללי:** Describe the overall fitness level of the class based on the 'overallAverageGrade'.
        2.  **נקודות חוזק:** Based on 'analysisByTest', identify the test with the highest 'averageGrade' as a strength.
        3.  **תחומים לשיפור:** Based on 'analysisByTest', identify the test with the lowest 'averageGrade' as an area for improvement.
        4.  **המלצה לפעילות:** Suggest one fun, group activity to improve the identified weak area. Briefly explain how the activity helps.

        Keep the analysis professional, clear, and concise. Write only in Hebrew.
        `;
        
        const insights = await callGemini(prompt);
        setAiContent(insights);
        setIsAiLoading(false);
    };

    const handleGenerateLessonPlan = async (e) => {
        e.preventDefault();
        setModal({ type: null, data: null });
        showAiModal('מפיק מערך שיעור...');
        
        const prompt = `
        אתה מורה מנוסה לחינוך גופני. כתוב מערך שיעור מפורט ומקצועי בעברית, מותאם במיוחד לתלמידי כיתה ${gradeLevel}.

        פרטי השיעור:
        - **כיתת יעד:** ${gradeLevel}
        - **מטרה מרכזית:** שיפור מרכיב הכושר הגופני: ${fitnessComponent}.
        - **ציוד זמין:** ${equipment || "ללא ציוד מיוחד"}.
        - **משך השיעור:** ${lessonDuration}.

        מבנה מערך השיעור (יש להקפיד על מבנה זה):
        1.  **חימום** (~10 דקות): פרט 2-3 תרגילי חימום דינמיים המתאימים לגיל זה.
        2.  **חלק עיקרי** (~${parseInt(lessonDuration) - 20} דקות): תאר 2-3 תרגילים, תחנות, או פעילויות מרכזיות. הסבר כיצד כל פעילות משפרת את ה-${fitnessComponent}, כיצד להשתמש בציוד הקיים, וספק התאמות להקל או להקשות על תלמידים ברמות שונות.
        3.  **משחק מסכם** (~5 דקות): הצע משחק מהנה הקשור למטרת השיעור ומתאים לכיתה ${gradeLevel}.
        4.  **שחרור ומתיחות** (~5 דקות): פרט 2-3 תרגילי מתיחות סטטיות לסיום.

        ודא שההוראות ברורות, בטיחותיות, מקצועיות, וכל הפעילויות מותאמות לגיל של תלמידי כיתה ${gradeLevel}.
        `;

        const lessonPlan = await callGemini(prompt);
        setAiContent(lessonPlan);
        setIsAiLoading(false);
    };

    const handleShareGroup = (e) => {
        e.preventDefault();
        if (!classToShare || !testToShare) {
            alert("יש לבחור כיתה ומבחן לשיתוף.");
            return;
        }

        const filteredRecords = records.filter(r => r.className === classToShare && r.testType === testToShare);

        if (filteredRecords.length === 0) {
            alert("לא נמצאו נתונים עבור הבחירה שלך.");
            return;
        }
        
        let message = `*סיכום תוצאות למבחן: ${testToShare}*\n*כיתה: ${classToShare}*\n\n`;
        filteredRecords
            .sort((a, b) => a.lastName.localeCompare(b.lastName))
            .forEach(r => {
                message += `${r.firstName} ${r.lastName}: ${r.originalResult} (ציון: ${r.grade})\n`;
            });
        
        const encodedMessage = encodeURIComponent(message);
        window.open(`https://api.whatsapp.com/send?text=${encodedMessage}`, '_blank');
        setModal({ type: null, data: null });
    };

    const handleGenerateTrainingPlan = async (e) => {
        e.preventDefault();
        const record = modal.data?.record;
        if (!record) return;

        setModal({ type: null, data: null });
        showAiModal(`מפיק תוכנית אימונים עבור ${record.firstName}...`);

        const prompt = `
        אתה מאמן כושר ומורה מנוסה לחינוך גופני. בנה תוכנית אימונים אישית מפורטת בעברית עבור התלמיד/ה.

        פרטי התלמיד/ה והמטרה:
        - שם: ${record.firstName} ${record.lastName}
        - מין: ${record.gender}
        - שכבה: ${record.gradeLevel}
        - מבחן לשיפור: ${record.testType}
        - תוצאה נוכחית: ${record.originalResult} (ציון: ${record.grade})
        - מטרת התוכנית: ${trainingGoal}
        - משך התוכנית: ${trainingDuration}

        מבנה התוכנית:
        - יש לחלק את התוכנית לשבועות (לפי משך התוכנית שצוין).
        - עבור כל שבוע, יש לפרט 2-3 יחידות אימון.
        - כל יחידת אימון צריכה לכלול:
            1.  **חימום:** תרגילים ספציפיים.
            2.  **חלק עיקרי:** תרגילים ממוקדים לשיפור המבחן, עם דגש על טכניקה, חזרות/סטים/זמנים.
            3.  **שחרור:** תרגילי הרפיה ומתיחות.
        
        הקפד על תוכנית הדרגתית, בטיחותית ומותאמת לגיל ולמין של התלמיד/ה.
        `;
        const trainingPlan = await callGemini(prompt);
        setAiContent(trainingPlan);
        setIsAiLoading(false);
    };

    const handleGenerateReportCardComment = async (e) => {
        e.preventDefault();
        if (!studentToEvaluate) {
            alert("יש לבחור תלמיד/ה.");
            return;
        }

        const studentRecords = records.filter(r => `${r.firstName} ${r.lastName}` === studentToEvaluate);
        
        setModal({ type: null, data: null });
        showAiModal(`מפיק הערכה עבור ${studentToEvaluate}...`);

        const studentDataForPrompt = studentRecords.map(r => ({
            test: r.testType,
            result: r.originalResult,
            grade: r.grade
        }));

        const prompt = `
        אתה מורה מנוסה לחינוך גופני. כתוב הערכה מילולית לתעודה עבור התלמיד/ה ${studentToEvaluate}.
        ההערכה צריכה להיות בעברית, מאוזנת, קונסטרוקטיבית ומעודדת.

        להלן סיכום ביצועי התלמיד/ה במבחנים השונים:
        ${JSON.stringify(studentDataForPrompt, null, 2)}

        מבנה ההערכה:
        1.  **פתיחה:** התייחסות כללית להשתתפות, התנהגות או מאמץ בשיעורים.
        2.  **נקודות חוזק:** ציין 1-2 תחומים (מבחנים) בהם התלמיד/ה הפגינ/ה יכולת גבוהה (ציונים גבוהים).
        3.  **תחומים לשיפור:** ציין 1-2 תחומים בהם יש מקום להשתפר (ציונים נמוכים), תוך שימוש בביטויים מעודדים כמו "יש מקום לחיזוק" או "מומלץ להשקיע מאמץ נוסף ב...".
        4.  **סיום:** משפט סיכום חיובי ומעודד.

        הקפד על ניסוח מקצועי ומכבד.
        `;

        const reportComment = await callGemini(prompt);
        setAiContent(reportComment);
        setIsAiLoading(false);
    };

    // --- RENDER ---
    return (
        <div className="bg-slate-100 min-h-screen" style={{ fontFamily: "'Rubik', sans-serif" }} dir="rtl">
            <div className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
                <header className="text-center mb-8">
                    <h1 className="text-3xl sm:text-4xl md:text-5xl font-bold text-blue-600">מחשבון ציונים לחינוך גופני ✨</h1>
                    <p className="text-md sm:text-lg text-slate-600 mt-2">הזן נתונים, קבל ציונים והפק תובנות ומערכי שיעור מבוססי AI</p>
                    <p className="text-xs text-slate-400 mt-2">זכויות יוצרים © לירון טל</p>
                </header>

                <main className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    {/* Input Form Section */}
                    <div className="lg:col-span-1 text-right bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-semibold mb-6 border-b-2 border-slate-200 pb-3">הוספת רשומה חדשה</h2>
                        <form onSubmit={handleFormSubmit} className="space-y-4">
                             <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label htmlFor="gender" className="block text-sm font-medium text-slate-700 mb-1">מין</label>
                                    <select id="gender" required disabled={lockForm} value={gender} onChange={e => setGender(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-slate-100">
                                        <option value="בנות">בנות</option>
                                        <option value="בנים">בנים</option>
                                    </select>
                                </div>
                                <div>
                                    <label htmlFor="grade-level" className="block text-sm font-medium text-slate-700 mb-1">שכבה</label>
                                    <select id="grade-level" required disabled={lockForm} value={gradeLevel} onChange={e => setGradeLevel(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-slate-100">
                                        {gradeLevelOptions.map(grade => {
                                            let displayText = grade;
                                            if (grade === 'ז') displayText = "ז'";
                                            if (grade === 'ח') displayText = "ח'";
                                            if (grade === 'ט') displayText = "ט'";
                                            if (grade === 'י') displayText = "י'";
                                            if (grade === 'יא') displayText = 'י"א';
                                            if (grade === 'יב') displayText = 'י"ב';
                                            return <option key={grade} value={grade}>{displayText}</option>
                                        })}
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label htmlFor="class-name-select" className="block text-sm font-medium text-slate-700 mb-1">כיתה</label>
                                <select id="class-name-select" required disabled={lockForm} value={className} onChange={e => setClassName(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-slate-100">
                                    {classOptions.map(cls => <option key={cls} value={cls}>{cls}</option>)}
                                </select>
                            </div>
                            <div>
                                <label htmlFor="test-date" className="block text-sm font-medium text-slate-700 mb-1">תאריך</label>
                                <input type="date" id="test-date" required disabled={lockForm} value={testDate} onChange={e => setTestDate(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-slate-100" />
                            </div>
                            <div>
                                <label htmlFor="test-type" className="block text-sm font-medium text-slate-700 mb-1">סוג המבחן</label>
                                <select id="test-type" required disabled={lockForm} value={testType} onChange={e => setTestType(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-slate-100">
                                    {testTypeOptions.length > 0 ? testTypeOptions.map(test => <option key={test} value={test}>{test}</option>) : <option disabled>לא נמצאו מבחנים</option>}
                                </select>
                            </div>

                            <div className="flex items-center pt-2">
                                <input id="lock-form" type="checkbox" checked={lockForm} onChange={e => setLockForm(e.target.checked)} className="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 ml-2" />
                                <label htmlFor="lock-form" className="block text-sm text-slate-900">נעל הגדרות להזנה מהירה</label>
                            </div>

                            <hr className="my-4 border-slate-200" />

                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label htmlFor="first-name" className="block text-sm font-medium text-slate-700 mb-1">שם פרטי</label>
                                    <input type="text" id="first-name" required value={firstName} onChange={e => setFirstName(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="לדוגמה: דנה" />
                                </div>
                                <div>
                                    <label htmlFor="last-name" className="block text-sm font-medium text-slate-700 mb-1">שם משפחה</label>
                                    <input type="text" id="last-name" required value={lastName} onChange={e => setLastName(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="לדוגמה: כהן" />
                                </div>
                            </div>
                            
                            <div>
                                <label htmlFor="result" className="block text-sm font-medium text-slate-700 mb-1">תוצאה ({unitDisplay})</label>
                                <input type="text" id="result" required value={result} onChange={e => setResult(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="לזמן: דקות:שניות (למשל 8:30)" />
                            </div>
                            
                            <button type="submit" className="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 shadow-md">
                                חשב והוסף לטבלה
                            </button>
                        </form>
                    </div>

                    {/* Results Table Section */}
                    <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                        <div className="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                            <h2 className="text-2xl font-semibold text-right w-full sm:w-auto">רשומות שהוזנו</h2>
                            <div className="flex gap-2 flex-wrap justify-center">
                                <button onClick={() => setModal({ type: 'shareGroup' })} className="bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 transition-transform transform hover:scale-105 shadow-md text-sm sm:text-base">
                                    שתף קבוצה
                                </button>
                                <button onClick={exportToCSV} className="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105 shadow-md text-sm sm:text-base">
                                    ייצא ל-Excel
                                </button>
                                <button onClick={handleClearAll} className="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-transform transform hover:scale-105 shadow-md text-sm sm:text-base">
                                    נקה הכל
                                </button>
                            </div>
                        </div>
                        <div className="overflow-x-auto border border-slate-200 rounded-lg">
                            <table className="min-w-full divide-y divide-slate-200">
                                <thead className="bg-slate-50">
                                    <tr>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">שם מלא</th>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider hidden sm:table-cell">כיתה</th>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">מבחן</th>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">תוצאה</th>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">ציון</th>
                                        <th className="px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">פעולות</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-slate-200">
                                    {records.length === 0 ? (
                                        <tr><td colSpan="6" className="text-center py-8 text-slate-500">לא נמצאו רשומות.</td></tr>
                                    ) : (
                                        records.map(record => (
                                            <tr key={record.id} className={record.grade >= 90 ? 'bg-green-50/50 hover:bg-green-100' : record.grade < 65 ? 'bg-red-50/50 hover:bg-red-100' : 'hover:bg-slate-50'}>
                                                <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-slate-900 text-right">{record.firstName} {record.lastName}</td>
                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-slate-500 hidden sm:table-cell text-right">{record.className}</td>
                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-slate-500 text-right">{record.testType}</td>
                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-slate-500 text-right">{record.originalResult}</td>
                                                <td className={`px-4 py-4 whitespace-nowrap text-sm font-bold text-right ${getGradeColor(record.grade)}`}>{record.grade}</td>
                                                <td className="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
                                                    <div className="flex items-center justify-center gap-1 sm:gap-2">
                                                        <button onClick={() => handleShareToWhatsApp(record)} title="שתף בוואטסאפ" className="p-2 rounded-full hover:bg-slate-200 transition">
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-green-500" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.687-1.475L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.447-4.435-9.884-9.888-9.884-5.448 0-9.886 4.434-9.889 9.884-.001 2.225.651 4.315 1.731 6.086l.287.468-1.173 4.249 4.35-1.157.45.272z"/></svg>
                                                        </button>
                                                        <button onClick={() => handleGenerateFeedback(record)} title="הפק משוב AI" className="p-2 rounded-full hover:bg-slate-200 transition text-lg"> ✨ </button>
                                                        <button onClick={() => setModal({ type: 'trainingPlan', data: { record } })} title="הפק תוכנית אימונים" className="p-2 rounded-full hover:bg-slate-200 transition">
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.25a.75.75 0 00-1.5 0v2.5h-2.5a.75.75 0 000 1.5h2.5v2.5a.75.75 0 001.5 0v-2.5h2.5a.75.75 0 000-1.5h-2.5v-2.5z" clipRule="evenodd" /></svg>
                                                        </button>
                                                        <button onClick={() => handleDeleteRecord(record.id)} title="מחק רשומה" className="p-2 rounded-full hover:bg-slate-200 transition">
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                        <div id="summary" className="mt-6 p-4 bg-slate-50 rounded-lg text-right">
                            <h3 className="text-lg font-semibold mb-2">סיכום וכלים</h3>
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div className="text-center p-4 bg-white rounded-lg shadow-sm">
                                    <p className="text-sm text-slate-600">מספר רשומות</p>
                                    <p id="student-count" className="font-bold text-3xl text-blue-600">{records.length}</p>
                                </div>
                                <div className="text-center p-4 bg-white rounded-lg shadow-sm">
                                    <p className="text-sm text-slate-600">ממוצע ציונים</p>
                                    <p id="average-grade" className="font-bold text-3xl text-blue-600">{averageGrade}</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                                <button onClick={handleGenerateInsights} disabled={records.length < 3} className="bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-transform transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed shadow-md">
                                    ✨ הפק תובנות
                                </button>
                                <button onClick={() => setModal({ type: 'lessonPlan' })} className="bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105 shadow-md">
                                    ✨ צור מערך שיעור
                                </button>
                                <button onClick={() => setModal({ type: 'reportCard' })} disabled={records.length === 0} className="sm:col-span-2 lg:col-span-1 bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-transform transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed shadow-md">
                                    ✨ הפק הערכה לתעודה
                                </button>
                            </div>
                        </div>
                    </div>
                </main>

                {/* --- Modals --- */}
                {modal.type && (
                    <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center p-4 z-50">
                         <div className="bg-white rounded-lg shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col text-right">
                            {/* Generic Modal Close Button */}
                             <button onClick={() => setModal({ type: null, data: null })} className="absolute top-2 left-2 text-slate-400 hover:text-slate-600">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>

                            {modal.type === 'confirm' && (
                                <div className="p-6 text-center">
                                    <h3 className="text-lg font-medium text-slate-900">{modal.data.title}</h3>
                                    <p className="text-sm text-slate-500 mt-2">{modal.data.message}</p>
                                    <div className="mt-6 flex justify-center gap-4">
                                        <button onClick={() => setModal({ type: null, data: null })} className="py-2 px-4 rounded-lg bg-slate-200 text-slate-800 hover:bg-slate-300">ביטול</button>
                                        <button onClick={modal.data.onConfirm} className="py-2 px-4 rounded-lg bg-red-600 text-white hover:bg-red-700">אישור</button>
                                    </div>
                                </div>
                            )}

                            {modal.type === 'ai' && (
                                <>
                                    <h3 className="text-xl font-semibold text-slate-900 p-4 border-b">{modal.data.title}</h3>
                                    <div className="p-6 overflow-y-auto">
                                        {isAiLoading ? (
                                            <div className="flex justify-center items-center h-40">
                                                <div className="loader" style={{borderTopColor: '#3b82f6', width: '50px', height: '50px', animation: 'spin 1s linear infinite', borderRadius: '50%', border: '5px solid #f3f3f3'}}></div>
                                            </div>
                                        ) : (
                                            <div className="text-slate-700 leading-relaxed whitespace-pre-wrap" style={{fontFamily: 'Assistant, sans-serif'}}>{aiContent}</div>
                                        )}
                                    </div>
                                </>
                            )}
                            
                            {/* Other Modals Forms */}
                            {(modal.type === 'lessonPlan' || modal.type === 'shareGroup' || modal.type === 'trainingPlan' || modal.type === 'reportCard') && (
                                <div className="p-6">
                                    {modal.type === 'lessonPlan' && (
                                        <form onSubmit={handleGenerateLessonPlan}>
                                            <h3 className="text-xl font-semibold text-slate-900 mb-4">מחולל מערכי שיעור ✨</h3>
                                            <div className="space-y-4">
                                                <div><label htmlFor="fitness-component" className="block text-sm font-medium text-slate-700 mb-1">מרכיב כושר לשיפור</label><select id="fitness-component" value={fitnessComponent} onChange={e => setFitnessComponent(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option>סיבולת לב-ריאה</option><option>כוח</option><option>מהירות וזריזות</option><option>גמישות</option><option>קואורדינציה</option></select></div>
                                                <div><label htmlFor="equipment" className="block text-sm font-medium text-slate-700 mb-1">ציוד זמין</label><input type="text" id="equipment" value={equipment} onChange={e => setEquipment(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm" placeholder="לדוגמה: כדורים, קונוסים" /></div>
                                                <div><label htmlFor="lesson-duration" className="block text-sm font-medium text-slate-700 mb-1">משך השיעור</label><select id="lesson-duration" value={lessonDuration} onChange={e => setLessonDuration(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option>45 דקות</option><option>90 דקות</option></select></div>
                                            </div>
                                            <div className="mt-6 flex justify-end gap-4"><button type="button" onClick={() => setModal({ type: null, data: null })} className="py-2 px-4 rounded-lg bg-slate-200">ביטול</button><button type="submit" className="py-2 px-4 rounded-lg bg-teal-600 text-white">הפק מערך</button></div>
                                        </form>
                                    )}
                                    {modal.type === 'shareGroup' && (
                                        <form onSubmit={handleShareGroup}>
                                            <h3 className="text-xl font-semibold text-slate-900 mb-4">שיתוף קבוצתי</h3>
                                            <div className="space-y-4">
                                                <div><label htmlFor="class-to-share" className="block text-sm font-medium text-slate-700 mb-1">בחר כיתה</label><select id="class-to-share" value={classToShare} onChange={e => setClassToShare(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option value="">בחר כיתה</option>{uniqueClassesToShare.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                                                <div><label htmlFor="test-to-share" className="block text-sm font-medium text-slate-700 mb-1">בחר מבחן</label><select id="test-to-share" value={testToShare} onChange={e => setTestToShare(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option value="">בחר מבחן</option>{uniqueTestsToShare.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                                            </div>
                                            <div className="mt-6 flex justify-end gap-4"><button type="button" onClick={() => setModal({ type: null, data: null })} className="py-2 px-4 rounded-lg bg-slate-200">ביטול</button><button type="submit" className="py-2 px-4 rounded-lg bg-cyan-500 text-white">צור ושתף</button></div>
                                        </form>
                                    )}
                                    {modal.type === 'trainingPlan' && (
                                         <form onSubmit={handleGenerateTrainingPlan}>
                                            <h3 className="text-xl font-semibold text-slate-900 mb-2">מחולל תוכנית אימונים ✨</h3>
                                            <p className="text-sm text-slate-600 mb-4">תלמיד/ה: {modal.data.record.firstName} {modal.data.record.lastName}</p>
                                            <div className="space-y-4">
                                                <div><label htmlFor="training-goal" className="block text-sm font-medium text-slate-700 mb-1">מטרת התוכנית</label><input type="text" id="training-goal" value={trainingGoal} onChange={e => setTrainingGoal(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm" placeholder="לדוגמה: שיפור התוצאה ב-10%" /></div>
                                                <div><label htmlFor="training-duration" className="block text-sm font-medium text-slate-700 mb-1">משך התוכנית</label><select id="training-duration" value={trainingDuration} onChange={e => setTrainingDuration(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option value="שבוע">שבוע 1</option><option value="שבועיים">שבועיים</option><option value="4 שבועות">4 שבועות</option></select></div>
                                            </div>
                                            <div className="mt-6 flex justify-end gap-4"><button type="button" onClick={() => setModal({ type: null, data: null })} className="py-2 px-4 rounded-lg bg-slate-200">ביטול</button><button type="submit" className="py-2 px-4 rounded-lg bg-indigo-600 text-white">הפק תוכנית</button></div>
                                        </form>
                                    )}
                                    {modal.type === 'reportCard' && (
                                        <form onSubmit={handleGenerateReportCardComment}>
                                            <h3 className="text-xl font-semibold text-slate-900 mb-4">מחולל הערכה לתעודה ✨</h3>
                                            <div className="space-y-4">
                                                <div><label htmlFor="student-to-evaluate" className="block text-sm font-medium text-slate-700 mb-1">בחר תלמיד/ה להערכה</label><select id="student-to-evaluate" value={studentToEvaluate} onChange={e => setStudentToEvaluate(e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white"><option value="">בחר תלמיד/ה</option>{Array.from(uniqueStudentsToEvaluate).map(s => <option key={s.id} value={`${s.firstName} ${s.lastName}`}>{s.firstName} {s.lastName}</option>)}</select></div>
                                            </div>
                                            <div className="mt-6 flex justify-end gap-4"><button type="button" onClick={() => setModal({ type: null, data: null })} className="py-2 px-4 rounded-lg bg-slate-200">ביטול</button><button type="submit" className="py-2 px-4 rounded-lg bg-orange-500 text-white">הפק הערכה</button></div>
                                        </form>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                )}
            </div>
            <style>{`
                @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Assistant:wght@400;700&display=swap');
                body { font-family: 'Rubik', sans-serif; }
                .loader {
                    border-top-color: #3b82f6;
                    width: 50px;
                    height: 50px;
                    animation: spin 1s linear infinite;
                    border-radius: 50%;
                    border: 5px solid #f3f3f3;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `}</style>
        </div>
    );
}
